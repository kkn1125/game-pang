var __defProp=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value;var __publicField=(obj,key,value)=>(__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),value);(function(){const relList=document.createElement("link").relList;if(relList&&relList.supports&&relList.supports("modulepreload"))return;for(const link of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(link);new MutationObserver(mutations=>{for(const mutation of mutations)if(mutation.type==="childList")for(const node of mutation.addedNodes)node.tagName==="LINK"&&node.rel==="modulepreload"&&processPreload(node)}).observe(document,{childList:!0,subtree:!0});function getFetchOpts(link){const fetchOpts={};return link.integrity&&(fetchOpts.integrity=link.integrity),link.referrerPolicy&&(fetchOpts.referrerPolicy=link.referrerPolicy),link.crossOrigin==="use-credentials"?fetchOpts.credentials="include":link.crossOrigin==="anonymous"?fetchOpts.credentials="omit":fetchOpts.credentials="same-origin",fetchOpts}function processPreload(link){if(link.ep)return;link.ep=!0;const fetchOpts=getFetchOpts(link);fetch(link.href,fetchOpts)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Reflect2;(function(Reflect3){(function(factory){var root=typeof commonjsGlobal=="object"?commonjsGlobal:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),exporter=makeExporter(Reflect3);typeof root.Reflect>"u"?root.Reflect=Reflect3:exporter=makeExporter(root.Reflect,exporter),factory(exporter);function makeExporter(target,previous){return function(key,value){typeof target[key]!="function"&&Object.defineProperty(target,key,{configurable:!0,writable:!0,value}),previous&&previous(key,value)}}})(function(exporter){var hasOwn=Object.prototype.hasOwnProperty,supportsSymbol=typeof Symbol=="function",toPrimitiveSymbol=supportsSymbol&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",iteratorSymbol=supportsSymbol&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",supportsCreate=typeof Object.create=="function",supportsProto={__proto__:[]}instanceof Array,downLevel=!supportsCreate&&!supportsProto,HashMap={create:supportsCreate?function(){return MakeDictionary(Object.create(null))}:supportsProto?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:downLevel?function(map,key){return hasOwn.call(map,key)}:function(map,key){return key in map},get:downLevel?function(map,key){return hasOwn.call(map,key)?map[key]:void 0}:function(map,key){return map[key]}},functionPrototype=Object.getPrototypeOf(Function),usePolyfill=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",_Map=!usePolyfill&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:CreateMapPolyfill(),_Set=!usePolyfill&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:CreateSetPolyfill(),_WeakMap=!usePolyfill&&typeof WeakMap=="function"?WeakMap:CreateWeakMapPolyfill(),Metadata=new _WeakMap;function decorate(decorators,target,propertyKey,attributes){if(IsUndefined(propertyKey)){if(!IsArray(decorators))throw new TypeError;if(!IsConstructor(target))throw new TypeError;return DecorateConstructor(decorators,target)}else{if(!IsArray(decorators))throw new TypeError;if(!IsObject(target))throw new TypeError;if(!IsObject(attributes)&&!IsUndefined(attributes)&&!IsNull(attributes))throw new TypeError;return IsNull(attributes)&&(attributes=void 0),propertyKey=ToPropertyKey(propertyKey),DecorateProperty(decorators,target,propertyKey,attributes)}}exporter("decorate",decorate);function metadata(metadataKey,metadataValue){function decorator(target,propertyKey){if(!IsObject(target))throw new TypeError;if(!IsUndefined(propertyKey)&&!IsPropertyKey(propertyKey))throw new TypeError;OrdinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey)}return decorator}exporter("metadata",metadata);function defineMetadata(metadataKey,metadataValue,target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey)}exporter("defineMetadata",defineMetadata);function hasMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryHasMetadata(metadataKey,target,propertyKey)}exporter("hasMetadata",hasMetadata);function hasOwnMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryHasOwnMetadata(metadataKey,target,propertyKey)}exporter("hasOwnMetadata",hasOwnMetadata);function getMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryGetMetadata(metadataKey,target,propertyKey)}exporter("getMetadata",getMetadata);function getOwnMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryGetOwnMetadata(metadataKey,target,propertyKey)}exporter("getOwnMetadata",getOwnMetadata);function getMetadataKeys(target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryMetadataKeys(target,propertyKey)}exporter("getMetadataKeys",getMetadataKeys);function getOwnMetadataKeys(target,propertyKey){if(!IsObject(target))throw new TypeError;return IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey)),OrdinaryOwnMetadataKeys(target,propertyKey)}exporter("getOwnMetadataKeys",getOwnMetadataKeys);function deleteMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError;IsUndefined(propertyKey)||(propertyKey=ToPropertyKey(propertyKey));var metadataMap=GetOrCreateMetadataMap(target,propertyKey,!1);if(IsUndefined(metadataMap)||!metadataMap.delete(metadataKey))return!1;if(metadataMap.size>0)return!0;var targetMetadata=Metadata.get(target);return targetMetadata.delete(propertyKey),targetMetadata.size>0||Metadata.delete(target),!0}exporter("deleteMetadata",deleteMetadata);function DecorateConstructor(decorators,target){for(var i=decorators.length-1;i>=0;--i){var decorator=decorators[i],decorated=decorator(target);if(!IsUndefined(decorated)&&!IsNull(decorated)){if(!IsConstructor(decorated))throw new TypeError;target=decorated}}return target}function DecorateProperty(decorators,target,propertyKey,descriptor){for(var i=decorators.length-1;i>=0;--i){var decorator=decorators[i],decorated=decorator(target,propertyKey,descriptor);if(!IsUndefined(decorated)&&!IsNull(decorated)){if(!IsObject(decorated))throw new TypeError;descriptor=decorated}}return descriptor}function GetOrCreateMetadataMap(O,P,Create){var targetMetadata=Metadata.get(O);if(IsUndefined(targetMetadata)){if(!Create)return;targetMetadata=new _Map,Metadata.set(O,targetMetadata)}var metadataMap=targetMetadata.get(P);if(IsUndefined(metadataMap)){if(!Create)return;metadataMap=new _Map,targetMetadata.set(P,metadataMap)}return metadataMap}function OrdinaryHasMetadata(MetadataKey,O,P){var hasOwn2=OrdinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn2)return!0;var parent=OrdinaryGetPrototypeOf(O);return IsNull(parent)?!1:OrdinaryHasMetadata(MetadataKey,parent,P)}function OrdinaryHasOwnMetadata(MetadataKey,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,!1);return IsUndefined(metadataMap)?!1:ToBoolean(metadataMap.has(MetadataKey))}function OrdinaryGetMetadata(MetadataKey,O,P){var hasOwn2=OrdinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn2)return OrdinaryGetOwnMetadata(MetadataKey,O,P);var parent=OrdinaryGetPrototypeOf(O);if(!IsNull(parent))return OrdinaryGetMetadata(MetadataKey,parent,P)}function OrdinaryGetOwnMetadata(MetadataKey,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,!1);if(!IsUndefined(metadataMap))return metadataMap.get(MetadataKey)}function OrdinaryDefineOwnMetadata(MetadataKey,MetadataValue,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,!0);metadataMap.set(MetadataKey,MetadataValue)}function OrdinaryMetadataKeys(O,P){var ownKeys=OrdinaryOwnMetadataKeys(O,P),parent=OrdinaryGetPrototypeOf(O);if(parent===null)return ownKeys;var parentKeys=OrdinaryMetadataKeys(parent,P);if(parentKeys.length<=0)return ownKeys;if(ownKeys.length<=0)return parentKeys;for(var set=new _Set,keys=[],_i=0,ownKeys_1=ownKeys;_i<ownKeys_1.length;_i++){var key=ownKeys_1[_i],hasKey=set.has(key);hasKey||(set.add(key),keys.push(key))}for(var _a=0,parentKeys_1=parentKeys;_a<parentKeys_1.length;_a++){var key=parentKeys_1[_a],hasKey=set.has(key);hasKey||(set.add(key),keys.push(key))}return keys}function OrdinaryOwnMetadataKeys(O,P){var keys=[],metadataMap=GetOrCreateMetadataMap(O,P,!1);if(IsUndefined(metadataMap))return keys;for(var keysObj=metadataMap.keys(),iterator=GetIterator(keysObj),k=0;;){var next=IteratorStep(iterator);if(!next)return keys.length=k,keys;var nextValue=IteratorValue(next);try{keys[k]=nextValue}catch(e){try{IteratorClose(iterator)}finally{throw e}}k++}}function Type(x){if(x===null)return 1;switch(typeof x){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return x===null?1:6;default:return 6}}function IsUndefined(x){return x===void 0}function IsNull(x){return x===null}function IsSymbol(x){return typeof x=="symbol"}function IsObject(x){return typeof x=="object"?x!==null:typeof x=="function"}function ToPrimitive(input,PreferredType){switch(Type(input)){case 0:return input;case 1:return input;case 2:return input;case 3:return input;case 4:return input;case 5:return input}var hint=PreferredType===3?"string":PreferredType===5?"number":"default",exoticToPrim=GetMethod(input,toPrimitiveSymbol);if(exoticToPrim!==void 0){var result=exoticToPrim.call(input,hint);if(IsObject(result))throw new TypeError;return result}return OrdinaryToPrimitive(input,hint==="default"?"number":hint)}function OrdinaryToPrimitive(O,hint){if(hint==="string"){var toString_1=O.toString;if(IsCallable(toString_1)){var result=toString_1.call(O);if(!IsObject(result))return result}var valueOf=O.valueOf;if(IsCallable(valueOf)){var result=valueOf.call(O);if(!IsObject(result))return result}}else{var valueOf=O.valueOf;if(IsCallable(valueOf)){var result=valueOf.call(O);if(!IsObject(result))return result}var toString_2=O.toString;if(IsCallable(toString_2)){var result=toString_2.call(O);if(!IsObject(result))return result}}throw new TypeError}function ToBoolean(argument){return!!argument}function ToString(argument){return""+argument}function ToPropertyKey(argument){var key=ToPrimitive(argument,3);return IsSymbol(key)?key:ToString(key)}function IsArray(argument){return Array.isArray?Array.isArray(argument):argument instanceof Object?argument instanceof Array:Object.prototype.toString.call(argument)==="[object Array]"}function IsCallable(argument){return typeof argument=="function"}function IsConstructor(argument){return typeof argument=="function"}function IsPropertyKey(argument){switch(Type(argument)){case 3:return!0;case 4:return!0;default:return!1}}function GetMethod(V,P){var func=V[P];if(func!=null){if(!IsCallable(func))throw new TypeError;return func}}function GetIterator(obj){var method=GetMethod(obj,iteratorSymbol);if(!IsCallable(method))throw new TypeError;var iterator=method.call(obj);if(!IsObject(iterator))throw new TypeError;return iterator}function IteratorValue(iterResult){return iterResult.value}function IteratorStep(iterator){var result=iterator.next();return result.done?!1:result}function IteratorClose(iterator){var f=iterator.return;f&&f.call(iterator)}function OrdinaryGetPrototypeOf(O){var proto=Object.getPrototypeOf(O);if(typeof O!="function"||O===functionPrototype||proto!==functionPrototype)return proto;var prototype=O.prototype,prototypeProto=prototype&&Object.getPrototypeOf(prototype);if(prototypeProto==null||prototypeProto===Object.prototype)return proto;var constructor=prototypeProto.constructor;return typeof constructor!="function"||constructor===O?proto:constructor}function CreateMapPolyfill(){var cacheSentinel={},arraySentinel=[],MapIterator=function(){function MapIterator2(keys,values,selector){this._index=0,this._keys=keys,this._values=values,this._selector=selector}return MapIterator2.prototype["@@iterator"]=function(){return this},MapIterator2.prototype[iteratorSymbol]=function(){return this},MapIterator2.prototype.next=function(){var index=this._index;if(index>=0&&index<this._keys.length){var result=this._selector(this._keys[index],this._values[index]);return index+1>=this._keys.length?(this._index=-1,this._keys=arraySentinel,this._values=arraySentinel):this._index++,{value:result,done:!1}}return{value:void 0,done:!0}},MapIterator2.prototype.throw=function(error){throw this._index>=0&&(this._index=-1,this._keys=arraySentinel,this._values=arraySentinel),error},MapIterator2.prototype.return=function(value){return this._index>=0&&(this._index=-1,this._keys=arraySentinel,this._values=arraySentinel),{value,done:!0}},MapIterator2}();return function(){function Map2(){this._keys=[],this._values=[],this._cacheKey=cacheSentinel,this._cacheIndex=-2}return Object.defineProperty(Map2.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map2.prototype.has=function(key){return this._find(key,!1)>=0},Map2.prototype.get=function(key){var index=this._find(key,!1);return index>=0?this._values[index]:void 0},Map2.prototype.set=function(key,value){var index=this._find(key,!0);return this._values[index]=value,this},Map2.prototype.delete=function(key){var index=this._find(key,!1);if(index>=0){for(var size=this._keys.length,i=index+1;i<size;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,key===this._cacheKey&&(this._cacheKey=cacheSentinel,this._cacheIndex=-2),!0}return!1},Map2.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=cacheSentinel,this._cacheIndex=-2},Map2.prototype.keys=function(){return new MapIterator(this._keys,this._values,getKey)},Map2.prototype.values=function(){return new MapIterator(this._keys,this._values,getValue)},Map2.prototype.entries=function(){return new MapIterator(this._keys,this._values,getEntry)},Map2.prototype["@@iterator"]=function(){return this.entries()},Map2.prototype[iteratorSymbol]=function(){return this.entries()},Map2.prototype._find=function(key,insert){return this._cacheKey!==key&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=key)),this._cacheIndex<0&&insert&&(this._cacheIndex=this._keys.length,this._keys.push(key),this._values.push(void 0)),this._cacheIndex},Map2}();function getKey(key,_){return key}function getValue(_,value){return value}function getEntry(key,value){return[key,value]}}function CreateSetPolyfill(){return function(){function Set2(){this._map=new _Map}return Object.defineProperty(Set2.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set2.prototype.has=function(value){return this._map.has(value)},Set2.prototype.add=function(value){return this._map.set(value,value),this},Set2.prototype.delete=function(value){return this._map.delete(value)},Set2.prototype.clear=function(){this._map.clear()},Set2.prototype.keys=function(){return this._map.keys()},Set2.prototype.values=function(){return this._map.values()},Set2.prototype.entries=function(){return this._map.entries()},Set2.prototype["@@iterator"]=function(){return this.keys()},Set2.prototype[iteratorSymbol]=function(){return this.keys()},Set2}()}function CreateWeakMapPolyfill(){var UUID_SIZE=16,keys=HashMap.create(),rootKey=CreateUniqueKey();return function(){function WeakMap2(){this._key=CreateUniqueKey()}return WeakMap2.prototype.has=function(target){var table=GetOrCreateWeakMapTable(target,!1);return table!==void 0?HashMap.has(table,this._key):!1},WeakMap2.prototype.get=function(target){var table=GetOrCreateWeakMapTable(target,!1);return table!==void 0?HashMap.get(table,this._key):void 0},WeakMap2.prototype.set=function(target,value){var table=GetOrCreateWeakMapTable(target,!0);return table[this._key]=value,this},WeakMap2.prototype.delete=function(target){var table=GetOrCreateWeakMapTable(target,!1);return table!==void 0?delete table[this._key]:!1},WeakMap2.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap2}();function CreateUniqueKey(){var key;do key="@@WeakMap@@"+CreateUUID();while(HashMap.has(keys,key));return keys[key]=!0,key}function GetOrCreateWeakMapTable(target,create){if(!hasOwn.call(target,rootKey)){if(!create)return;Object.defineProperty(target,rootKey,{value:HashMap.create()})}return target[rootKey]}function FillRandomBytes(buffer,size){for(var i=0;i<size;++i)buffer[i]=Math.random()*255|0;return buffer}function GenRandomBytes(size){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(size)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(size)):FillRandomBytes(new Uint8Array(size),size):FillRandomBytes(new Array(size),size)}function CreateUUID(){var data=GenRandomBytes(UUID_SIZE);data[6]=data[6]&79|64,data[8]=data[8]&191|128;for(var result="",offset=0;offset<UUID_SIZE;++offset){var byte=data[offset];(offset===4||offset===6||offset===8)&&(result+="-"),byte<16&&(result+="0"),result+=byte.toString(16).toLowerCase()}return result}}function MakeDictionary(obj){return obj.__=void 0,delete obj.__,obj}})})(Reflect2||(Reflect2={}));const cat="/game-pang/assets/cat-pad-bed89044.png",dog="/game-pang/assets/dog-pad-b402bc20.png",duck="/game-pang/assets/duck-pad-ce2d1de9.png",lion="/game-pang/assets/lion-pad-80d5ded3.png",mouse="/game-pang/assets/mouse-pad-7221a183.png",rabbit="/game-pang/assets/rabbit-pad-58c9a6de.png",panda="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVR4nO3dMXKbQABAUcj4ILQpU+VGOVRulCplWt2EXMDERuEvQnqvtD0C4T87s2JXzOu6TnC0L2efAM9JWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgk3kYcZJ7nEd+VNA84xgj5tVrXNb9WRiwSwiIhLBLCIiEsEkNmhYP4lt4HYsQiISwSwiIhLBLCIiEsEpf7uOF2u519CqdYluXsU9jFiEVCWCSERUJYJIRFYh7xhNW9S5NfdeZ3j3tmi5Ymc1nCIiEsEsIiISwSo+4Vbs1CLCdunbaJ14hFQlgkhEVCWCSEReJyK0i3HLnCcu+9yjOP/aiMWCSERUJYJIRFQlgkhEVi1McN795svmdqfbWNm3ttvb+ta/Wva7gsy9ZNfkuTuSZhkRAWCWGREBaJUzes3nPseT5mQjPofR/2WkdeKxtWuSxhkRAWCWGREBYJYZEQFglhkRAWCWGREBaJy21YHXGP7+f8bdff/1h/v/vzEef6qIxYJIRFQlgkhEVCWCSEReJyS5P5PEuTeTrCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSpz5h1T3E//fBVyV5wirPRVgkhEVCWCSEReLsDau7ZovTNE3rn1/d2Tyw+ev3zV+NPI/PMmKREBYJYZEQFglhkRAWiVEbVo98uVe9Q33YRRzxPzdikRAWCWGREBYJYZEYMivk9RixSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi8RfMV1eKJwGsWMAAAAASUVORK5CYII=",pig="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAAsTAAALEwEAmpwYAAACy0lEQVR4nO3cTW7TQACA0RhxAnqKnqAS7JG4Tg7S6yCxB8EeiVO0VwgrNpAxspXP+Xtv6yZxpp9GGk/s6XA47ODU3pz7BLhNwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIi8XaLD5mmaXRo9Ayl4Qv4x9xzqI6O4xaPrjJjkRAWCWGREBYJYZHYZFW4G6xcXp6fj/7xw36/eKVzBxaN4W43O475GJqxSAiLhLBICIuEsEgIi8S0xYbkNE1HP+Tw68fRv3/9/HX4Xg/7/fBjlp7XhVp0WeHdpw/DN5oen45/wOHgcgPXSVgkhEVCWCSERWKrTehF5lY6L7tVG9dXY83q7xKZsUgIi4SwSAiLhLBIbLUqPLo3NT0+LdpDnHP48m3xa0Zef34/2XvVRvuBfw5vdR5/M2OREBYJYZEQFglhkbjIvcK5X5AOX3NFK7k11ozJOZmxSAiLhLBICIuEsEgIi8RFXm5YY3Qj69zzo87p2s53KTMWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFomzPtx2i32xmYfhntU5v7uH23K1hEVCWCSERUJYJG7+F6SX+ngjvyCFFYRFQlgkhEVCWCSEReJmLjcsNX18Pzy2dMl/65cO1jBjkRAWCWGREBYJYZG4+VXhaOP4lCu2e179jZixSAiLhLBICIuEsEhsdcPq6FB+I+ut37D6n+93dOC3+J+bsUgIi4SwSAiLhLBInHtVODI8qXvdl5tZ/S0fXKtCrpWwSAiLhLBICIuEsEhc6uWGOf0JX6aTDaLLDVwtYZEQFglhkRAWiU1WhdwfMxYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGR+A0JtoS2YzC8swAAAABJRU5ErkJggg==",racoon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAAsTAAALEwEAmpwYAAACsklEQVR4nO3dMW7UQABAUYyocwauEYkb0CKKFFShQaLnCPRINFBRpEC03CAS1+AMXMBcYL2w4D9rb94rk9V61vkaaTyxd5rn+RGs7fG5B8BlEhYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWiScjDjJN04hnJU0DjjFCfq7mec7PlRmLhLBICIuEsEgIi8SQVeGSn98+rfZeT1+8voin9K58TlZ7r1OZsUgIi4SwSAiLhLBICIvEWS83/IulJfTnm2eDR9JY+nxrXoYYwYxFQlgkhEVCWCSERWKTq8Jjm6e/fnwcOJLxXr69Ofjzq+t9rRbNWCSERUJYJIRFQlgkpnnu/6N3mhbvjzx48BH7fkurrzV9/XCXH+P27v7Yrw+e+BF/czMWCWGREBYJYZEQFolN7hWOcGzFduqKccTqb2/MWCSERUJYJIRFQlgkhEVi1OWGfLN5aTN2qzeyrjXeY6+/vbtf2m321GT2SVgkhEVCWCSERUJYJIRFQlgkhEVCWCSERWLUDatnuzF1yaXcsHrM0n6kb1hlt4RFQlgkhEVCWCTOuirc6oNqr67fnPT6vX0Oq0J2S1gkhEVCWCSERUJYJB7s87GO2erlgz0xY5EQFglhkRAWCWGR2OR36ViV/b0/bJj7Lh0ui7BICIuEsEgIi8S5V4VLFgf1/d2r/xvMTj1//2XpV6efXKtC9kpYJIRFQlgkhEViq6vCY/oBb9NqJ9GqkN0SFglhkRAWCWGREBaJIZcbeHjMWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEXiN4nUdKCmUo6iAAAAAElFTkSuQmCC",all="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFF2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4xLWMwMDAgNzkuN2E3YTIzNiwgMjAyMS8wOC8xMi0wMDoyNToyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjUgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wOS0yMVQxNjo0MzowNiswOTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDktMjFUMTY6NDU6MDQrMDk6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDktMjFUMTY6NDU6MDQrMDk6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDFkYmQ3YzYtYmM3Yy1mMzQwLWE0NGYtMTBiNjRlMzc3MmRlIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQxZGJkN2M2LWJjN2MtZjM0MC1hNDRmLTEwYjY0ZTM3NzJkZSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjQxZGJkN2M2LWJjN2MtZjM0MC1hNDRmLTEwYjY0ZTM3NzJkZSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6NDFkYmQ3YzYtYmM3Yy1mMzQwLWE0NGYtMTBiNjRlMzc3MmRlIiBzdEV2dDp3aGVuPSIyMDIzLTA5LTIxVDE2OjQzOjA2KzA5OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuNSAoV2luZG93cykiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+EU2kYgAAAxNJREFUeJzt3bGtK0UYgNE1gpDgJbRALS+gDgoiog4kqIWEAkgowTTgsRgzn3dsnxO+J1/77v000r/r3blcr9cDVvvm7A/AexIWCWGREBYJYZEQFglhkRAWCWGREBYJYZH4dvYFl8ul+By7mb2A+vYHZfaashWLhLBICIuEsEgIi4SwSEyfbngjw/n51z//vvnvP//13e0XfP0y+llvfxpixIpFQlgkhEVCWCSEReIye3HxBS9C3/wFR5PfcdyZ/mZ9/XLvf1/qQLoIzRaERUJYJIRFQlgk3mkqnJr+lk1+jxpPjFseYFMhWxAWCWGREBYJYZF4p6lwZPrpvQ98g3T2LY5j0+lvxFTIFoRFQlgkhEVCWCSEReITblgdjfXP2ETopU4prGTFIiEsEsIiISwSwiJx9lTo8T//373p9rTjaMUiISwSwiIhLBLCIvGsqXDuZtIff9hy0jnZ7WPyxz/jV5z40F0rFglhkRAWCWGREBaJ1VPhMx4l9Ixvfq5y7mcdTYxPmBatWCSERUJYJIRFQlgkhEXikedjrduZlL3cec7X9XqdOhVhxSIhLBLCIiEsEsIisfQitOnvNfz0++0/+28L38OKRUJYJIRFQlgkhEVi9V468zdV3vLY3jTrvNLnvfNZh9PfL9+PXjL849pLhy0Ii4SwSAiLhLBIrL5h9fZUMbpBcnb6uvce815ty5Obn3c0+R3HY9PfKlYsEsIiISwSwiIhLBLCIrH6IvSsM/fSGf/i6y5Cn/t7LHx/F6HZgrBICIuEsEgIi8TZO6x+6r44K215DK1YJIRFQlgkhEVCWCTOngqf4cz9bD52p1grFglhkRAWCWGREBaJs79ButLKm2KX2PVm0kf4BilbEBYJYZEQFglhkRAWiXc63TCSn4Z44OnEx7HpaYURpxvYgrBICIuEsEgIi8QnTIUj048xWrk3zasxFbIFYZEQFglhkRAWiU+eCu+Zvcn17Q+KqZAtCIuEsEgIi4SwSAiLxPTpBvgvrFgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJP4FezOhEhVDQ4EAAAAASUVORK5CYII=",horizon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFF2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4xLWMwMDAgNzkuN2E3YTIzNiwgMjAyMS8wOC8xMi0wMDoyNToyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjUgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wOS0yMVQxNjo0MzowNiswOTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDktMjFUMTY6NDQ6NTcrMDk6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDktMjFUMTY6NDQ6NTcrMDk6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MGQ5NzVjZGMtYjk1Ny05ZDQxLWFmNjYtOWZhZTNmZTgyMGU3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjBkOTc1Y2RjLWI5NTctOWQ0MS1hZjY2LTlmYWUzZmU4MjBlNyIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjBkOTc1Y2RjLWI5NTctOWQ0MS1hZjY2LTlmYWUzZmU4MjBlNyI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MGQ5NzVjZGMtYjk1Ny05ZDQxLWFmNjYtOWZhZTNmZTgyMGU3IiBzdEV2dDp3aGVuPSIyMDIzLTA5LTIxVDE2OjQzOjA2KzA5OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuNSAoV2luZG93cykiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+vPewmwAAArFJREFUeJzt3TFuE0EYgNE1gpIiDQeg4SwpOAcHoso5IoWz0HAAGg5AYVoKT8DWfJ6N816ZRM5a/jTSvzu7PhyPxw1me7P6ALhNwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIiISwSwiIhLBLCIiEsEsIi8XbWCx0Oh1kvdanRU3qXH9jALo931sOOrVgkhEVCWCSERUJYJIRFYtrphis6OQ8/fP958o+/fPqwcqwfz+7ffp3++f3dLk9DnMuKRUJYJIRFQlgkhEVir1PhcJoaTn8/3mUHc1U3Mi1asUgIi4SwSAiLhLBIrJ4Kz7rut21Tp785e3Cv5fxpcdsWToxWLBLCIiEsEsIiISwSh1k3KP7jhtXzdn1OvO738PH3tNc61/Lrl/d3o98MPyw3rLJrwiIhLBLCIiEsEsIiMfN0w+vdTvzSjE9DbMfjccqFaysWCWGREBYJYZEQFomrbE02/a3x+en0x/t4hf9txSIhLBLCIiEsEsIisXRr8vAmTP7baPLbtm17/Pp+9Ctbk3mZhEVCWCSERUJYJK41FY700+IzuyWXOvM9Dq/7jSe/bbvgMUamQnZNWCSERUJYJIRFQlgkVj81+fQ4/NyTgOedilj7DasDF5xW8F06vB7CIiEsEsIiISwSq6fCkfGkM5oYX9g251uZ/kasWCSERUJYJIRFQlgkVm9Nnmn0RpYf2MAuj9fWZHZNWCSERUJYJIRFQlgkpp1ugL9ZsUgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIuEsEgIi4SwSAiLhLBICIvEH8aJbSDTrOIKAAAAAElFTkSuQmCC",vertical="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFF2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNy4xLWMwMDAgNzkuN2E3YTIzNiwgMjAyMS8wOC8xMi0wMDoyNToyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0RXZ0PSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VFdmVudCMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjUgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wOS0yMVQxNjo0MzowNiswOTowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDktMjFUMTY6NDQ6NDMrMDk6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDktMjFUMTY6NDQ6NDMrMDk6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MzE0ZDZkNjgtNmE1ZS1mMzQwLTg2NTEtZTMxNzhhZGE5Nzg1IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjMxNGQ2ZDY4LTZhNWUtZjM0MC04NjUxLWUzMTc4YWRhOTc4NSIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjMxNGQ2ZDY4LTZhNWUtZjM0MC04NjUxLWUzMTc4YWRhOTc4NSI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNyZWF0ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6MzE0ZDZkNjgtNmE1ZS1mMzQwLTg2NTEtZTMxNzhhZGE5Nzg1IiBzdEV2dDp3aGVuPSIyMDIzLTA5LTIxVDE2OjQzOjA2KzA5OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgMjIuNSAoV2luZG93cykiLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+8z2zTAAAAqxJREFUeJzt3TGO00AYgFEHQUmxx9qCc3AgKs6BBGfZhgPQcART0GYiOfIXj7PvlViLbPnTSL+dSS7rui6wtw9HnwDPSVgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSEReLj0SdwzeVyOfoUtn6s9tATnvFTwFYsEsIiISwSwiIhLBLCIjHl44YHGc7o39/+XP33r78/Xf+D15fR/3X4c5OjWLFICIuEsEgIi4SwSFxmfIG580voqxc4mvyW5cb0t9Xry62ju13kjPfQikVCWCSERUJYJIRF4pmmwk3T326T373GE+Pmi5/xHlqxSAiLhLBICIuEsEgIi8QZHzec67HCVnc8hpjxHlqxSAiLhLBICIuEsEjMOhXut5n0QF9+7rcf+Me3z8Nj67pOtzHWikVCWCSERUJYJIRFYtap8NbhXU54gg2rW3lXCMIiISwSwiIhLBJn/HLbre/F5huZ/pvu/d6erFgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRFQlgkhEVCWCSERUJYJIRF4owbVmfdgLrV1us41QZXKxYJYZEQFglhkRAWCWGRmPVbk8cn9evvA8/k8Ua/v+O3dGARFhFhkRAWCWGRmHUqvHX4+gmfbFq8Y/rzWzogLBLCIiEsEsIiccapcGS6aXE0+S3LfdPfyIz30IpFQlgkhEVCWCSEReKZpsKRfFq851Ofy44bUGe8h1YsEsIiISwSwiIhLBLCIvEeHjeMbN4Uu+fHifc04z20YpEQFglhkRAWCWGReM9T4S2n+kbjGe+hFYuEsEgIi4SwSAiLhLBITPm4gfOzYpEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGREBYJYZEQFglhkRAWCWGR+AcqYYsAxaK/BQAAAABJRU5ErkJggg==",MODE="production",createCanvas=id=>{const canvas=document.createElement("canvas"),ctx=canvas.getContext("2d",{desynchronized:!1,alpha:!0,willReadFrequently:!1});return id&&(canvas.id=id),[canvas,ctx]},catImg=document.createElement("img");catImg.src=cat;const dogImg=document.createElement("img");dogImg.src=dog;const lionImg=document.createElement("img");lionImg.src=lion;const duckImg=document.createElement("img");duckImg.src=duck;const mouseImg=document.createElement("img");mouseImg.src=mouse;const rabbitImg=document.createElement("img");rabbitImg.src=rabbit;const pandaImg=document.createElement("img");pandaImg.src=panda;const pigImg=document.createElement("img");pigImg.src=pig;const racoonImg=document.createElement("img");racoonImg.src=racoon;const allImg=document.createElement("img");allImg.src=all;const horizonImg=document.createElement("img");horizonImg.src=horizon;const verticalImg=document.createElement("img");verticalImg.src=vertical;const images={cat:catImg,dog:dogImg,lion:lionImg,duck:duckImg,mouse:mouseImg,rabbit:rabbitImg,panda:pandaImg,pig:pigImg,racoon:racoonImg,all:allImg,horizon:horizonImg,vertical:verticalImg},ROOT=document.querySelector("#root"),[bgCanvas,bgCtx]=createCanvas("bg"),[gameCanvas,gameCtx]=createCanvas("game"),[effectCanvas,effectCtx]=createCanvas("effect"),[scoreCanvas,scoreCtx]=createCanvas("score"),[selectCanvas,selectCtx]=createCanvas("select"),[questCanvas,questCtx]=createCanvas("quest");bgCtx.translate(.5,.5);gameCtx.translate(.5,.5);effectCtx.translate(.5,.5);scoreCtx.translate(.5,.5);selectCtx.translate(.5,.5);const isMobile=()=>!!window.navigator.userAgent.match(/android|mobile/gi),RUN_MODE={}.VITE_RUN_MODE||"none",SUB_OPTIONS={SIZE:{RATIO:1}},OPTIONS={SIZE:{UNIT:50},ITEM:{MATCH_LIMIT:3},WIDTH:{GAME:{X:9,Y:9}},ANIMATION:{SPEED:isMobile()?.13:.1,FRAME:16},GAME:{TURN:75,HINT:RUN_MODE==="test"?1/0:5}},RESPONSIVE_UNIT_SIZE=()=>OPTIONS.SIZE.UNIT+SUB_OPTIONS.SIZE.RATIO,BG_COLOR="#ffffff",CELL_OUTLINE_COLOR="#565656",CELL_HOVER_COLOR="#565656",CELL_SELECTED_COLOR="#48c46e",wait=[],STORE_NAME="pang_store",BASE_TYPE_SCORE=[["dog",1],["duck",3],["mouse",4],["lion",6],["pig",7],["panda",8],["racoon",9],["horizon",0],["vertical",0],["all",0]],TestCase2=[["cat","mouse","cat","mouse","dog","lion","rabbit","lion","mouse"],["dog","lion","dog","lion","mouse","cat","dog","mouse","cat"],["lion","rabbit","dog","cat","racoon","mouse","racoon","rabbit","cat"],["dog","cat","rabbit","lion","dog","rabbit","cat","dog","mouse"],["lion","racoon","lion","pig","rabbit","pig","mouse","cat","lion"],["dog","cat","mouse","mouse","racoon","dog","lion","mouse","pig"],["lion","rabbit","dog","cat","lion","pig","rabbit","cat","pig"],["cat","lion","dog","racoon","cat","dog","lion","rabbit","mouse"],["dog","cat","lion","mouse","dog","lion","cat","racoon","cat"]],RANDOM_ITEM=[{item:"all",probability:.25},{item:"horizon",probability:.3},{item:"vertical",probability:.3}],set3=(obj,num)=>new Array(num).fill(0).map((ar,index)=>Object.assign({...obj},{title:obj.target+` 수집가 - ${index+1}`,content:`${obj.target}를 ${(2+index)*5}마리 잡으세요.`,amount:(2+index)*5,score:100*(index+1),turn:0,type:obj.type})),set3Turn=(obj,num)=>new Array(num).fill(0).map((ar,index)=>Object.assign({...obj},{title:obj.target+` 수집가 - ${index+1}`,content:`${obj.target}를 ${(2+index)*5}마리 잡으세요.`,amount:(2+index)*5,score:25*(index+1),turn:3*(index+1),type:obj.type})),QUEST_LIST_OBJ=[{title:"돼지가 너무 많아!",content:"돼지를 15마리 잡으세요.",amount:15,score:150,turn:0,type:"pig"},{title:"찍찍찌익!",content:"쥐를 30마리 잡으세요.",amount:30,score:300,turn:0,type:"mouse"},...set3({target:"팬더",type:"panda"},3),...set3({target:"돼지",type:"pig"},3),...set3({target:"사자",type:"lion"},3),...set3({target:"강아지",type:"dog"},3),...set3({target:"고양이",type:"cat"},3),...set3({target:"너구리",type:"racoon"},3),...set3({target:"오리",type:"duck"},3),...set3({target:"토끼",type:"rabbit"},3),...set3({target:"쥐",type:"mouse"},3),...set3Turn({target:"팬더",type:"panda"},3),...set3Turn({target:"돼지",type:"pig"},3),...set3Turn({target:"사자",type:"lion"},3),...set3Turn({target:"강아지",type:"dog"},3),...set3Turn({target:"고양이",type:"cat"},3),...set3Turn({target:"너구리",type:"racoon"},3),...set3Turn({target:"오리",type:"duck"},3),...set3Turn({target:"토끼",type:"rabbit"},3),...set3Turn({target:"쥐",type:"mouse"},3)];class Logger{constructor(name){__publicField(this,"name","SYS");__publicField(this,"_logger",console);__publicField(this,"directories",[]);__publicField(this,"only",()=>new Logger(this.name+":only"));this.name=name}convert(color,...data){return[]}reform(str){return`[${str}] >`}dir(dir){return this.directories.push(dir),this}get log(){return()=>{}}get debug(){return()=>{}}get error(){return()=>{}}clearDir(){this.directories=[]}}const _Quest=class _Quest{constructor(title,content,condition,result){__publicField(this,"id");__publicField(this,"title");__publicField(this,"content");__publicField(this,"currentAmount",0);__publicField(this,"condition");__publicField(this,"result",{score:0,turn:0});__publicField(this,"isDone",!1);__publicField(this,"isFail",!1);__publicField(this,"isDaily",!1);__publicField(this,"deletion",!1);__publicField(this,"logger");this.logger=new Logger("Quest"),this.id=_Quest.autoGenerate(),this.title=title,this.content=content,this.result.score=result.score||0,this.result.turn=result.turn||0,this.condition=Object.assign(condition,{amount:condition.amount}),this.logger.dir("constructor").log("current id",_Quest.id)}static createQuest({title,content,score,turn,type,amount}){return new _Quest(title,content,{type,amount},{score,turn})}success(){this.isDone=!0}fail(){this.isFail=!0}};__publicField(_Quest,"id",0),__publicField(_Quest,"autoGenerate",()=>_Quest.id+=1);let Quest=_Quest;class BaseModule{constructor(mode){__publicField(this,"mode","none");this.mode=mode}}class Animator extends BaseModule{constructor(mode){super(mode);__publicField(this,"logger");this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode)}}const capitalize=str=>str.charAt(0).toLowerCase()+str.slice(1),responseBlockAxis=(x,y)=>{const centerX=innerWidth/2,centerY=innerHeight/2,horizonValue=OPTIONS.WIDTH.GAME.X*RESPONSIVE_UNIT_SIZE(),verticalValue=OPTIONS.WIDTH.GAME.Y*RESPONSIVE_UNIT_SIZE(),halfHorizon=horizonValue/2,halfVertical=verticalValue/2,resX=centerX+x-halfHorizon,resY=centerY+y-halfVertical;return[resX,resY]},responsePointerAxis=(x,y)=>{const centerX=innerWidth/2,centerY=innerHeight/2,horizonValue=OPTIONS.WIDTH.GAME.X*RESPONSIVE_UNIT_SIZE(),verticalValue=OPTIONS.WIDTH.GAME.Y*RESPONSIVE_UNIT_SIZE(),halfHorizon=horizonValue/2,halfVertical=verticalValue/2,unitCenterX=Math.floor((x-centerX+halfHorizon)/RESPONSIVE_UNIT_SIZE()),unitCenterY=Math.floor((y-centerY+halfVertical)/RESPONSIVE_UNIT_SIZE());return[unitCenterX,unitCenterY]},_Cell=class _Cell{constructor(type,x,y,score){__publicField(this,"id");__publicField(this,"originType");__publicField(this,"type");__publicField(this,"x");__publicField(this,"y");__publicField(this,"scale");__publicField(this,"matched");__publicField(this,"isPang");__publicField(this,"score");__publicField(this,"isSelected");__publicField(this,"isHover");__publicField(this,"isInfo");__publicField(this,"isHint");__publicField(this,"logger");this.id=_Cell.autoIncrement,this.originType=type,this.type=type,this.x=x,this.y=y,this.scale=1,this.matched=!1,this.isPang=!1,this.score=score,this.isSelected=!1,this.isHover=!1,this.isInfo=!1,this.isHint=!1,_Cell.autoIncrement++,this.logger=new Logger("Cell")}getDirectionWith(dstCell){const srcX=this.x,srcY=this.y,dstX=dstCell.x,dstY=dstCell.y;return dstX>srcX?"right":dstX<srcX?"left":dstY>srcY?"down":dstY<srcY?"up":null}moveX(to){let resolver;const promise=new Promise(resolve=>resolver=resolve),fromX=this.x,toX=to,direction=fromX!==to&&fromX>to,move=setInterval(()=>{this.x+=fromX>to?-OPTIONS.ANIMATION.SPEED/2:OPTIONS.ANIMATION.SPEED/2,direction?toX>=this.x&&(clearInterval(move),resolver(!0),this.x=fromX):toX<=this.x&&(clearInterval(move),resolver(!0),this.x=fromX)},OPTIONS.ANIMATION.FRAME);return promise}moveY(to){let resolver;const promise=new Promise(resolve=>resolver=resolve),fromY=this.y,toY=to,direction=fromY!==to&&fromY>to,move=setInterval(()=>{this.y+=fromY>to?-OPTIONS.ANIMATION.SPEED/2:OPTIONS.ANIMATION.SPEED/2,direction?toY>=this.y&&(clearInterval(move),this.y=fromY,resolver(this)):toY<=this.y&&(clearInterval(move),this.y=fromY,resolver(this))},OPTIONS.ANIMATION.FRAME);return promise}scaleUp(){let resolver;const promise=new Promise(resolve=>resolver=resolve),animation=setInterval(()=>{this.scale+=5*OPTIONS.ANIMATION.SPEED**2,1.2<this.scale&&(clearInterval(animation),resolver(!0))},OPTIONS.ANIMATION.FRAME);return promise}async zoomMotion(){await this.scaleUp()}swapEffect(target,direction){let resolver;const promise=new Promise(resolve=>resolver=resolve);switch(direction){case"left":case"right":Promise.all([this.moveX(target.x),target.moveX(this.x)]).then(()=>{resolver(!0)});break;case"up":case"down":Promise.all([this.moveY(target.y),target.moveY(this.y)]).then(()=>{resolver(!0)});break;default:setTimeout(()=>{resolver(!1)},0);break}return this.logger.dir("swapEffect").debug(`from ${this.type} to ${target.type} swapping...`),promise}pang(){this.type="",this.isPang=!0}highlight(type){const[x,y]=responseBlockAxis(this.x*RESPONSIVE_UNIT_SIZE(),this.y*RESPONSIVE_UNIT_SIZE());switch(type){case"hover":bgCtx.fillStyle=CELL_HOVER_COLOR+"56";break;case"select":bgCtx.fillStyle=CELL_SELECTED_COLOR+"56";break}bgCtx.beginPath(),bgCtx.roundRect(x,y,RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE(),15),bgCtx.fill()}checkTypeItem(){return!!this.type.match(/^(all|horizon|vertical)$/g)}checkOriginTypeItem(){return!!this.originType.match(/^(all|horizon|vertical)$/g)}render(){const[x,y]=responseBlockAxis(this.x,this.y),image=images[this.type];image?(gameCtx.imageSmoothingQuality="low",gameCtx.imageSmoothingEnabled=!0,gameCtx.drawImage(image,Math.floor((1-this.scale)*RESPONSIVE_UNIT_SIZE()/2+this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x)),Math.floor((1-this.scale)*RESPONSIVE_UNIT_SIZE()/2+this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y)),RESPONSIVE_UNIT_SIZE()*this.scale,RESPONSIVE_UNIT_SIZE()*this.scale),this.isInfo&&(selectCtx.fillStyle="green",selectCtx.font="bold 10px Arial",selectCtx.fillText(`[${this.type}] ${Math.floor(this.x)}, ${Math.floor(this.y)}`,Math.floor(this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x))+1,Math.floor(this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y))+8),selectCtx.font="",selectCtx.fillStyle="#000000",selectCtx.strokeStyle="#00000056",selectCtx.strokeRect(Math.floor(this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x)),Math.floor(this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y)),RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE()),selectCtx.strokeStyle="#000000"),this.isHint&&(selectCtx.strokeStyle="green",selectCtx.strokeRect(Math.floor(this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x)),Math.floor(this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y)),RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE()),selectCtx.fillStyle="#00ff0056",selectCtx.fillRect(Math.floor(this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x)),Math.floor(this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y)),RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE()),selectCtx.strokeStyle="#000000",selectCtx.fillStyle="#000000")):(gameCtx.fillStyle="#000000",this.type==="horizon"&&(gameCtx.font="bold 16px arial",gameCtx.fillText("↔",this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x)+RESPONSIVE_UNIT_SIZE()/2-gameCtx.measureText("↔").width/2,this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y)+8+RESPONSIVE_UNIT_SIZE()/2),gameCtx.font=""),this.type==="vertical"&&(gameCtx.font="bold 16px arial",gameCtx.fillText("↕",this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x)+RESPONSIVE_UNIT_SIZE()/2-gameCtx.measureText("↕").width/2,this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y)+8+RESPONSIVE_UNIT_SIZE()/2),gameCtx.font="")),this.isSelected&&this.highlight("select")}renderOtherCanvas(ctx){const[x,y]=responseBlockAxis(this.x,this.y),image=images[this.type];image?ctx.drawImage(image,this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x),this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y),RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE()):(ctx.fillStyle="#00000000",ctx.fillRect(this.x*RESPONSIVE_UNIT_SIZE()+Math.floor(x-this.x),this.y*RESPONSIVE_UNIT_SIZE()+Math.floor(y-this.y),RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE()))}static copy(cell,toCell){return new _Cell(cell.type,toCell.x,toCell.y,cell.score)}static is(srcCell,dstCell){try{const{x:x1,y:y1}=srcCell,{x:x2,y:y2}=dstCell;return x1===x2&&y1===y2}catch{return!1}}deepCopySelf(){const type=this.originType,newCell=new _Cell(this.type,this.x,this.y,this.score);return newCell.originType=type,newCell}deepCopy(cell){return new _Cell(cell.type,cell.x,cell.y,cell.score)}deepCopyWithAxis(cell,x,y){return new _Cell(cell.type,x,y,cell.score)}};__publicField(_Cell,"autoIncrement",0);let Cell=_Cell;class BlockManager extends BaseModule{constructor(mode,scoreCalculator,questManager){super(mode);__publicField(this,"types",BASE_TYPE_SCORE);__publicField(this,"logger");__publicField(this,"blockSize",{x:50,y:50});__publicField(this,"map",[]);__publicField(this,"scoreCalculator");__publicField(this,"questManager");__publicField(this,"dupRemove",!1);__publicField(this,"animalsPang",{cat:0,dog:0,lion:0,duck:0,mouse:0,rabbit:0,panda:0,pig:0,racoon:0});__publicField(this,"gameEnd",!1);this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode),this.scoreCalculator=scoreCalculator,this.questManager=questManager}containsType(type){return this.types.some(types=>types[0]===type)}scoreUp(score){this.scoreCalculator.scoreUp(score)}async initialize(force=!1){if(wait.push(0),this.dupRemove=!1,force||this.mode!=="test"){const map=this.createMap([OPTIONS.WIDTH.GAME.X,OPTIONS.WIDTH.GAME.Y]);return this.logger.dir("initialize").log("created map",map),this.map=map,await this.removeDuplicate(),map}else{if(TestCase2.length!==OPTIONS.WIDTH.GAME.Y||TestCase2[0].length!==OPTIONS.WIDTH.GAME.X)throw new Error("Invalid map size");const map=this.createCustomMap(TestCase2);return this.logger.dir("initialize").log("created custom map",map),this.map=map,await this.removeDuplicate(),map}}resetScore(){this.scoreCalculator.resetCombos(),this.scoreCalculator.resetScores(),this.scoreCalculator.resetTurns()}resetQuest(){this.questManager.resetQuest()}async removeDuplicate(){let resolver;const promise=new Promise(resolve=>{resolver=resolve}),BASE_VALUE={FRAME:OPTIONS.ANIMATION.FRAME,SPEED:OPTIONS.ANIMATION.SPEED};return OPTIONS.ANIMATION.FRAME=0,OPTIONS.ANIMATION.SPEED=100,this.logger.dir("removeDuplicate").log("start remove"),await this.autoPangAndFill(),this.logger.dir("removeDuplicate").log("done remove"),this.resetScore(),this.resetQuest(),OPTIONS.ANIMATION.FRAME=BASE_VALUE.FRAME,OPTIONS.ANIMATION.SPEED=BASE_VALUE.SPEED,this.dupRemove=!0,setTimeout(()=>{resolver(!0)},16),promise}getCellScoreByType(type){const index=this.types.findIndex(typeScore=>typeScore[0]===type);return this.types[index][1]}getRandomCellType(){const onlyAnimals=this.types.filter(type=>!type[0].match(/^(all|horizon|vertical)$/g)),randomTypeIndex=Math.floor(Math.random()*onlyAnimals.length);return onlyAnimals[randomTypeIndex]}randomItemPickBasedOnPercentage(defaultType){const choice=RANDOM_ITEM.filter(q=>q.item!=="all")[Math.floor(Math.random()*(RANDOM_ITEM.length-1))];this.logger.dir("randomItemPickBasedOnPercentage").debug(choice);const itemProbabilities=RANDOM_ITEM,randomValue=Math.random();let cumulativeProbability=0;for(const itemInfo of itemProbabilities)if(cumulativeProbability+=itemInfo.probability,randomValue<=cumulativeProbability)return itemInfo.item;return choice.item}getRandomCellTypeMoreThanLessAnimalInMap(){this.logger.dir("getRandomCellTypeMoreThanLessAnimalInMap").log("getRandomNewCell");const desc=this.map.flat(1).reduce((acc,cur)=>{if(cur.type===""||cur.checkTypeItem())return acc;const index=acc.findIndex(ac=>ac[0]===cur.type);return index===-1?acc.push([cur.type,0]):acc[index][1]+=1,acc},[]).concat(this.questManager.quests.map(q=>[q.condition.type,0])).sort((a,b)=>a[1]-b[1]).slice(0,-1),randomMinIndex=Math.floor(Math.random()*desc.length),randomMin=desc[randomMinIndex],randomTypeIndex=this.types.findIndex(type=>type[0]===randomMin[0]);return this.types[randomTypeIndex]}createMap([xSize,ySize]){const maps=[];for(let y=0;y<ySize;y++){const cells=[];for(let x=0;x<xSize;x++){const[type,score]=this.getRandomCellType();cells.push(new Cell(type,x,y,score))}maps.push(cells)}return maps}createCustomMap(customMap){return customMap.map((row,y)=>row.map((cell,x)=>new Cell(cell,x,y,this.getCellScoreByType(cell))))}mockisInBoundary(mockMap,srcCell,dstCell){var _a,_b,_c,_d;const srcX=srcCell==null?void 0:srcCell.x,srcY=srcCell==null?void 0:srcCell.y;if(srcX===void 0||srcY===void 0)return!1;const topCell=(_a=mockMap[srcY-1])==null?void 0:_a[srcX],bottomCell=(_b=mockMap[srcY+1])==null?void 0:_b[srcX],leftCell=(_c=mockMap[srcY])==null?void 0:_c[srcX-1],rightCell=(_d=mockMap[srcY])==null?void 0:_d[srcX+1];return topCell===dstCell||bottomCell===dstCell||leftCell===dstCell||rightCell===dstCell}checkTypeItem(cell){return cell.checkTypeItem()}isInBoundary(srcCell,dstCell){var _a,_b,_c,_d;this.logger.dir("isInBoundary").debug("srcCell","dstCell",srcCell,dstCell);const srcX=srcCell==null?void 0:srcCell.x,srcY=srcCell==null?void 0:srcCell.y;if(srcX===void 0||srcY===void 0)return!1;const topCell=(_a=this.map[srcY-1])==null?void 0:_a[srcX],bottomCell=(_b=this.map[srcY+1])==null?void 0:_b[srcX],leftCell=(_c=this.map[srcY])==null?void 0:_c[srcX-1],rightCell=(_d=this.map[srcY])==null?void 0:_d[srcX+1],isIn=topCell===dstCell||bottomCell===dstCell||leftCell===dstCell||rightCell===dstCell;return this.logger.dir("swapBothCell").dir("isInBoundary").debug(isIn),isIn}inLinePang(srcCell,dstCell,direction){this.logger.dir("inLinePang").debug("validating pangable line by dst cell.");const horizonPangList=[],verticalPangList=[];if(direction==="left"){const upSrcLinePang=this.upLinePang(srcCell),downSrcLinePang=this.downLinePang(srcCell),leftSrcLinePang=this.leftLinePang(srcCell),upDstLinePang=dstCell.checkTypeItem()?[]:this.upLinePang(dstCell),downDstLinePang=dstCell.checkTypeItem()?[]:this.downLinePang(dstCell),rightDstLinePang=dstCell.checkTypeItem()?[]:this.rightLinePang(dstCell),concatSrcUpDown=[...new Set([...upSrcLinePang,...downSrcLinePang])],concatDstUpDown=[...new Set([...upDstLinePang,...downDstLinePang])],concatSrcLeft=[...new Set(leftSrcLinePang)],concatDstRight=[...new Set(rightDstLinePang)];concatSrcUpDown.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcUpDown.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstUpDown.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstUpDown.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcLeft.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcLeft.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstRight.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstRight.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcUpDown.length>2&&verticalPangList.push(...concatSrcUpDown),concatDstUpDown.length>2&&verticalPangList.push(...concatDstUpDown),concatSrcLeft.length>2&&horizonPangList.push(...concatSrcLeft),concatDstRight.length>2&&horizonPangList.push(...concatDstRight)}else if(direction==="right"){const upDstLinePang=dstCell.checkTypeItem()?[]:this.upLinePang(dstCell),downDstLinePang=dstCell.checkTypeItem()?[]:this.downLinePang(dstCell),leftDstLinePang=dstCell.checkTypeItem()?[]:this.leftLinePang(dstCell),upSrcLinePang=this.upLinePang(srcCell),downSrcLinePang=this.downLinePang(srcCell),rightSrcLinePang=this.rightLinePang(srcCell),concatSrcUpDown=[...new Set([...upSrcLinePang,...downSrcLinePang])],concatDstUpDown=[...new Set([...upDstLinePang,...downDstLinePang])],concatDstLeft=[...new Set(leftDstLinePang)],concatSrcRight=[...new Set(rightSrcLinePang)];concatSrcUpDown.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcUpDown.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstUpDown.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstUpDown.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstLeft.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstLeft.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcRight.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcRight.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcUpDown.length>2&&verticalPangList.push(...concatSrcUpDown),concatDstUpDown.length>2&&verticalPangList.push(...concatDstUpDown),concatDstLeft.length>2&&horizonPangList.push(...concatDstLeft),concatSrcRight.length>2&&horizonPangList.push(...concatSrcRight)}else if(direction==="up"){const upSrcLinePang=this.upLinePang(srcCell),leftSrcLinePang=this.leftLinePang(srcCell),rightSrcLinePang=this.rightLinePang(srcCell),downDstLinePang=dstCell.checkTypeItem()?[]:this.downLinePang(dstCell),leftDstLinePang=dstCell.checkTypeItem()?[]:this.leftLinePang(dstCell),rightDstLinePang=dstCell.checkTypeItem()?[]:this.rightLinePang(dstCell),concatSrcLeftRight=[...new Set([...leftSrcLinePang,...rightSrcLinePang])],concatDstLeftRight=[...new Set([...leftDstLinePang,...rightDstLinePang])],concatSrcUp=[...new Set(upSrcLinePang)],concatDstDown=[...new Set(downDstLinePang)];concatSrcLeftRight.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcLeftRight.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstLeftRight.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstLeftRight.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcUp.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcUp.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstDown.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstDown.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcLeftRight.length>2&&verticalPangList.push(...concatSrcLeftRight),concatDstLeftRight.length>2&&verticalPangList.push(...concatDstLeftRight),concatSrcUp.length>2&&horizonPangList.push(...concatSrcUp),concatDstDown.length>2&&horizonPangList.push(...concatDstDown)}else if(direction==="down"){const upDstLinePang=dstCell.checkTypeItem()?[]:this.upLinePang(dstCell),leftDstLinePang=dstCell.checkTypeItem()?[]:this.leftLinePang(dstCell),rightDstLinePang=dstCell.checkTypeItem()?[]:this.rightLinePang(dstCell),downSrcLinePang=this.downLinePang(srcCell),leftSrcLinePang=this.leftLinePang(srcCell),rightSrcLinePang=this.rightLinePang(srcCell),concatDstLeftRight=[...new Set([...leftDstLinePang,...rightDstLinePang])],concatSrcLeftRight=[...new Set([...leftSrcLinePang,...rightSrcLinePang])],concatDstUp=[...new Set(upDstLinePang)],concatSrcDown=[...new Set(downSrcLinePang)];concatSrcLeftRight.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcLeftRight.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstLeftRight.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstLeftRight.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatDstUp.length>OPTIONS.ITEM.MATCH_LIMIT&&concatDstUp.forEach(cell=>{cell.id===dstCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcDown.length>OPTIONS.ITEM.MATCH_LIMIT&&concatSrcDown.forEach(cell=>{cell.id===srcCell.id&&(this.map[cell.y][cell.x].type=this.randomItemPickBasedOnPercentage(this.map[cell.y][cell.x].type))}),concatSrcLeftRight.length>2&&verticalPangList.push(...concatSrcLeftRight),concatDstLeftRight.length>2&&verticalPangList.push(...concatDstLeftRight),concatDstUp.length>2&&horizonPangList.push(...concatDstUp),concatSrcDown.length>2&&horizonPangList.push(...concatSrcDown)}return this.logger.dir("inLinePang").dir("collected pang list").debug(horizonPangList,verticalPangList),[horizonPangList,verticalPangList]}upLinePang(targetCell){const targetX=targetCell.x,targetY=targetCell.y,temp=[targetCell];for(let y=targetY-1;y>=0;y--){const cell=this.map[y][targetX];if(cell.type===targetCell.type){temp.push(this.map[y][targetX]),this.logger.dir("upLinePang").debug("cell count",y);continue}this.logger.dir("upLinePang").error("cell is not matched type",cell);break}return this.logger.dir("upLinePang").log("pang list",temp),temp}downLinePang(targetCell){const targetX=targetCell.x,targetY=targetCell.y,temp=[targetCell];for(let y=targetY+1;y<OPTIONS.WIDTH.GAME.Y;y++){this.logger.dir("downLinePang").log(y,targetX);const cell=this.map[y][targetX];if(this.logger.dir("downLinePang").log(cell),cell.type===targetCell.type){temp.push(this.map[y][targetX]);continue}this.logger.dir("downLinePang").error("cell is not matched type",cell);break}return this.logger.dir("downLinePang").log("pang list",temp),temp}leftLinePang(targetCell){const targetX=targetCell.x,targetY=targetCell.y,temp=[targetCell];for(let x=targetX-1;x>=0;x--){const cell=this.map[targetY][x];if(cell.type===targetCell.type){temp.push(this.map[targetY][x]);continue}this.logger.dir("leftLinePang").error("cell is not matched type",cell);break}return this.logger.dir("leftLinePang").log("pang list",temp),temp}rightLinePang(targetCell){const targetX=targetCell.x,targetY=targetCell.y,temp=[targetCell];for(let x=targetX+1;x<OPTIONS.WIDTH.GAME.X;x++){const cell=this.map[targetY][x];if(cell&&cell.type===targetCell.type){temp.push(this.map[targetY][x]);continue}this.logger.dir("rightLinePang").error("cell is not matched type",cell);break}return this.logger.dir("rightLinePang").log("pang list",temp),temp}async revertSwap(srcCell,dstCell){let resolver;const promise=new Promise(resolve=>resolver=resolve);return setTimeout(()=>{this.swapBothCell(srcCell,dstCell).then(()=>{resolver(!0)})},150),promise}async swapBothCell(srcCell,dstCell){var _a,_b,_c,_d;if(this.logger.dir("swapBothCell").debug("before swap both cell:",this.map),this.logger.dir("swapBothCell").dir("src").debug("get both cell in this.map",(_a=this.map[srcCell==null?void 0:srcCell.y])==null?void 0:_a[srcCell==null?void 0:srcCell.x]),this.logger.dir("swapBothCell").dir("dest").debug("get both cell in this.map",(_b=this.map[dstCell==null?void 0:dstCell.y])==null?void 0:_b[dstCell==null?void 0:dstCell.x]),!((_c=this.map[srcCell==null?void 0:srcCell.y])!=null&&_c[srcCell==null?void 0:srcCell.x])||!((_d=this.map[dstCell==null?void 0:dstCell.y])!=null&&_d[dstCell==null?void 0:dstCell.x]))return!1;try{if(!this.isInBoundary(srcCell,dstCell))return!1}catch(error){return console.error(error),!1}const swapDirection=srcCell.getDirectionWith(dstCell);if(swapDirection===null)return!1;if(this.logger.dir("swapBothCell").log(swapDirection),await srcCell.swapEffect(dstCell,swapDirection)||this.logger.dir("swapBothCell").error("swap error"),this.logger.dir("swapBothCell").debug("success swapEffect."),dstCell.checkTypeItem()){if(dstCell.type==="horizon"){dstCell.type="";const temp=[];for(const cell of this.map.flat(1))srcCell.originType===cell.originType&&temp.push(...this.horizonPang(cell.x,cell.y));const removeDuplicated=[...new Set(temp)];this.logger.dir("swapBothCell").dir("horizon").debug(removeDuplicated),removeDuplicated.forEach(cell=>{this.animalsPang[cell.originType]+=1,this.questManager.questAmountUp(cell.originType),cell.pang(),this.scoreCalculator.scoreUp(cell.score)})}if(dstCell.type==="vertical"){const temp=[];dstCell.type="";for(const cell of this.map.flat(1))srcCell.originType===cell.originType&&temp.push(...this.verticalPang(cell.x,cell.y));const removeDuplicated=[...new Set(temp)];this.logger.dir("swapBothCell").dir("vertical").debug(removeDuplicated),removeDuplicated.forEach(cell=>{this.animalsPang[cell.originType]+=1,this.questManager.questAmountUp(cell.originType),cell.pang(),this.scoreCalculator.scoreUp(cell.score)})}if(dstCell.type==="all"){const temp=[];dstCell.type="";for(const cell of this.map.flat(1))srcCell.originType===cell.originType&&temp.push(...this.allPang(cell.x,cell.y));const removeDuplicated=[...new Set(temp)];this.logger.dir("swapBothCell").dir("all").debug(removeDuplicated),removeDuplicated.forEach(cell=>{this.animalsPang[cell.originType]+=1,this.questManager.questAmountUp(cell.originType),cell.pang(),this.scoreCalculator.scoreUp(cell.score)})}return await this.autoPangAndFill(),!0}const destCopyCell=Cell.copy(dstCell,srcCell),srcCopyCell=Cell.copy(srcCell,dstCell);this.map[srcCell.y][srcCell.x]=destCopyCell,this.map[dstCell.y][dstCell.x]=srcCopyCell;const swapedSrcCell=this.map[srcCell.y][srcCell.x],swapedDstCell=this.map[dstCell.y][dstCell.x];this.logger.dir("swapBothCell").dir("check src").debug(swapedSrcCell),this.logger.dir("swapBothCell").dir("check dst").debug(swapedDstCell);const pangResult=this.inLinePang(swapedDstCell,swapedSrcCell,swapDirection);return pangResult.every(cell=>cell.length===0)?(this.logger.dir("swapBothCell").debug("no matched cell line"),!1):(pangResult.flat(1).forEach(cell=>{cell.checkTypeItem()||(this.animalsPang[cell.type]+=1,this.questManager.questAmountUp(cell.type),cell.pang(),this.scoreCalculator.scoreUp(cell.score))}),!0)}async swapBothCellAndFill(srcCell,dstCell){return await this.swapBothCell(srcCell,dstCell)?(await this.searchColumnsAndFillEmptyCell(),!0):(this.logger.dir("swapBothCellAndFill").error("not swapped"),!1)}getColumnLineFromStartPoint(x,startPoint){const yValue=startPoint,temp=[];for(let level=0;level<=yValue;level++){const cell=this.map[level][x];cell&&temp.push(cell)}return temp}getMockColumnLine(mockMap,x){const yValue=OPTIONS.WIDTH.GAME.Y,temp=[];for(let level=0;level<yValue;level++){const cell=mockMap[level][x];cell&&temp.push(cell)}return temp}getColumnLine(x){const yValue=OPTIONS.WIDTH.GAME.Y,temp=[];for(let level=0;level<yValue;level++){const cell=this.map[level][x];cell&&temp.push(cell)}return temp}getMockPangableList(mockMap){const rows=this.searchMockRowsAndFilterPangable(mockMap),columns=this.searchMockColumnsAndFilterPangable(mockMap);this.logger.dir("getPangableList").debug("pagable",rows,columns);const rowScores=rows.reduce((acc,row)=>(row.length>3&&(acc+=row[0].score*row.slice(3).length),acc),0),columnScores=columns.reduce((acc,column)=>(column.length>3&&(acc+=column[0].score*column.slice(3).length),acc),0);return this.logger.dir("getPangableList").debug("추가 점수:",rowScores+columnScores),[...new Set([...rows,...columns].flat(1))]}getPangableList(){const rows=this.searchRowsAndFilterPangable(),columns=this.searchColumnsAndFilterPangable();this.logger.dir("getPangableList").debug("pagable",rows,columns);const rowScores=rows.reduce((acc,row)=>(row.length>3&&(acc+=row[0].score*row.slice(3).length),acc),0),columnScores=columns.reduce((acc,column)=>(column.length>3&&(acc+=column[0].score*column.slice(3).length),acc),0);return this.logger.dir("getPangableList").debug("추가 점수:",rowScores+columnScores),[...new Set([...rows,...columns].flat(1))]}mockingPangableColumnLines(){const mockMap=this.mockingMap(),isSuccess=[];for(const row of mockMap)for(const column in row){const[src,dst]=this.mockSwapBothCell(mockMap,row[Number(column)],row[Number(column)+1]),pangableColumns=this.searchMockColumnsAndFilterPangable(mockMap).map(group=>group.map(cell=>{const isSameSrc=Cell.is(src,cell),isSameDst=Cell.is(dst,cell);return isSameSrc?dst:isSameDst?src:cell.deepCopySelf()})),pangableRows=this.searchMockRowsAndFilterPangable(mockMap).map(group=>group.map(cell=>{const isSameSrc=Cell.is(src,cell),isSameDst=Cell.is(dst,cell);return isSameSrc?dst:isSameDst?src:cell.deepCopySelf()}));this.mockRevertSwap(mockMap,src,dst);const removeDup=[...pangableColumns,...pangableRows];removeDup.length>0&&isSuccess.push(...removeDup)}return isSuccess}mockingPangableRowLines(){const mockMap=this.mockingMap(),isSuccess=[];for(let column=0;column<OPTIONS.WIDTH.GAME.X;column++){const columns=this.getMockColumnLine(mockMap,column);for(const row in columns){const[src,dst]=this.mockSwapBothCell(mockMap,columns[Number(row)],columns[Number(row)+1]);if(!(src&&dst))continue;const pangableColumns=this.searchMockColumnsAndFilterPangable(mockMap).map(group=>group.map(cell=>{const isSameSrc=Cell.is(src,cell),isSameDst=Cell.is(dst,cell);return isSameSrc?dst:isSameDst?src:cell.deepCopySelf()})),pangableRows=this.searchMockRowsAndFilterPangable(mockMap).map(group=>group.map(cell=>{const isSameSrc=Cell.is(src,cell),isSameDst=Cell.is(dst,cell);return isSameSrc?dst:isSameDst?src:cell.deepCopySelf()}));this.mockRevertSwap(mockMap,src,dst);const removeDup=[...new Set([...pangableColumns,...pangableRows])];removeDup.length>0&&isSuccess.push(...removeDup)}}return isSuccess}mockPangableItem(){return this.mockingMap().flat(1).filter(cell=>cell.checkTypeItem()).map(cell=>[cell])}mockingMap(){return[...this.map].map(row=>row.map(cell=>cell.deepCopySelf()))}mockRevertSwap(mockMap,srcCell,dstCell){return this.mockSwapBothCell(mockMap,srcCell,dstCell)}mockSwapBothCell(mockMap,srcCell,dstCell){var _a,_b;if(!((_a=mockMap[srcCell==null?void 0:srcCell.y])!=null&&_a[srcCell==null?void 0:srcCell.x])||!((_b=mockMap[dstCell==null?void 0:dstCell.y])!=null&&_b[dstCell==null?void 0:dstCell.x]))return[];try{if(!this.mockisInBoundary(mockMap,srcCell,dstCell))return[]}catch(error){return console.error(error),[]}if(srcCell.getDirectionWith(dstCell)===null)return[];const destCopyCell=Cell.copy(dstCell,srcCell),srcCopyCell=Cell.copy(srcCell,dstCell);mockMap[srcCell.y][srcCell.x]=destCopyCell,mockMap[dstCell.y][dstCell.x]=srcCopyCell;const swapedSrcCell=mockMap[srcCell.y][srcCell.x],swapedDstCell=mockMap[dstCell.y][dstCell.x];return[swapedSrcCell,swapedDstCell]}allPang(x,y){const temp=[];return this.map[y][x].type="",temp.push(...this.verticalPang(x,y)),temp.push(...this.horizonPang(x,y)),temp}verticalPang(x,y){const temp=[];return this.map[y][x].type="",this.getColumnLine(x).forEach(cell=>{cell.type==="horizon"&&temp.push(...this.horizonPang(cell.x,cell.y)),cell.type==="all"&&temp.push(...this.allPang(cell.x,cell.y)),temp.push(cell)}),temp}horizonPang(x,y){const temp=[];return this.map[y][x].type="",this.map[y].forEach(cell=>{cell.type==="vertical"&&temp.push(...this.verticalPang(cell.x,cell.y)),cell.type==="all"&&temp.push(...this.allPang(cell.x,cell.y)),temp.push(cell)}),temp}async allPangAndAutoFill(x,y){this.scoreCalculator.turnCount();const temp=this.allPang(x,y),removeDuplicated=[...new Set(temp)];return this.logger.dir("allPangAndAutoFill").debug(removeDuplicated),removeDuplicated.forEach(cell=>{this.animalsPang[cell.type]+=1,this.questManager.questAmountUp(cell.type),cell.pang(),this.scoreCalculator.scoreUp(cell.score)}),await this.autoPangAndFill()}async verticalPangAndAutoFill(x,y){this.scoreCalculator.turnCount();const temp=this.verticalPang(x,y),removeDuplicated=[...new Set(temp)];return this.logger.dir("verticalPangAndAutoFill").debug(removeDuplicated),removeDuplicated.forEach(cell=>{this.animalsPang[cell.type]+=1,this.questManager.questAmountUp(cell.type),cell.pang(),this.scoreCalculator.scoreUp(cell.score)}),await this.autoPangAndFill()}async horizonPangAndAutoFill(x,y){this.scoreCalculator.turnCount();const temp=this.horizonPang(x,y),removeDuplicated=[...new Set(temp)];return this.logger.dir("horizonPangAndAutoFill").debug(removeDuplicated),removeDuplicated.forEach(cell=>{this.animalsPang[cell.type]+=1,this.questManager.questAmountUp(cell.type),cell.pang(),this.scoreCalculator.scoreUp(cell.score)}),await this.autoPangAndFill()}async autoPangAndFillInItem(){const rows=this.searchRowsAndFilterPangable(),columns=this.searchColumnsAndFilterPangable();this.logger.dir("getPangableList").debug(rows.length,columns.length);for(let i=0;i<rows.length+columns.length;i++)this.scoreCalculator.countUpCombo();this.getPangableList().forEach(cell=>{cell.checkTypeItem()||(this.animalsPang[cell.type]+=1,this.questManager.questAmountUp(cell.type),cell.pang(),this.scoreCalculator.scoreUp(cell.score))}),await this.searchEmptyColumnsAndFill();const isDone=this.getPangableList().length===0;if(this.logger.dir("autoPangAndFill").log("isDone",isDone),!isDone)return await this.autoPangAndFillInItem();const resultColumns=this.mockingPangableColumnLines(),resultRows=this.mockingPangableRowLines();return this.logger.dir("autoPangAndFill").dir("check mocking pangable").debug(resultColumns||resultRows),resultColumns.length>0||resultRows.length>0||(this.logger.dir("autoPangAndFill").dir("check mocking pangable").error("required reset game"),!document.querySelector("#modal")&&!this.gameEnd&&resultColumns.length===0&&resultRows.length===0&&this.scoreCalculator.popupShuffleModal()),isDone}async autoPangAndFill(loop=!0){const rows=this.searchRowsAndFilterPangable(),columns=this.searchColumnsAndFilterPangable();this.logger.dir("getPangableList").debug(rows.length,columns.length);for(let i=0;i<rows.length+columns.length;i++)this.scoreCalculator.countUpCombo();const pangableList=this.getPangableList();[...rows,...columns].forEach(group=>{group.length>OPTIONS.ITEM.MATCH_LIMIT&&group.every(gp=>gp.originType===group[0].originType)&&(group[Math.floor(group.length/2)].type=this.randomItemPickBasedOnPercentage(group[Math.floor(group.length/2)].type))}),this.logger.dir("searchEmptyColumnsAndFill").log("rows columns",rows,columns),pangableList.forEach(cell=>{if(!cell.checkOriginTypeItem()){const change=cell.checkTypeItem()?cell.type:"";this.animalsPang[cell.type]+=1,this.questManager.questAmountUp(cell.type),cell.pang(),change&&(cell.type=change),this.scoreCalculator.scoreUp(cell.score)}}),await this.searchEmptyColumnsAndFill();const isDone=this.getPangableList().length===0;if(this.logger.dir("autoPangAndFill").log("isDone",isDone),loop&&!isDone)return await this.autoPangAndFill();const resultColumns=this.mockingPangableColumnLines(),resultRows=this.mockingPangableRowLines();return this.logger.dir("autoPangAndFill").dir("check mocking pangable").debug(resultColumns||resultRows),resultColumns.length>0||resultRows.length>0||(this.logger.dir("autoPangAndFill").dir("check mocking pangable").error("required reset game"),!document.querySelector("#modal")&&!this.gameEnd&&resultColumns.length===0&&resultRows.length===0&&this.scoreCalculator.popupShuffleModal()),isDone}getHint(){const resultColumns=this.mockingPangableColumnLines(),resultRows=this.mockingPangableRowLines(),resultItems=this.mockPangableItem(),groups=[...resultColumns,...resultRows,...resultItems];this.logger.dir("getHint").debug("groups",groups);const group=groups[Math.floor(Math.random()*groups.length)];resultColumns.length>0||resultRows.length>0?group.forEach(cell=>{try{this.map[cell.y][cell.x].isHint=!0}catch{}}):this.logger.dir("autoPangAndFill").dir("check mocking pangable").error("required reset game")}async searchEmptyColumnsAndFill(){const promises=[];for(let index=0;index<OPTIONS.WIDTH.GAME.X;index++)promises.push(this.fillColumn(index));return await Promise.all(promises)}fillColumn(index){const promises=[],columnLine=this.getColumnLine(index),[startPoint,emptyAmount]=this.getEmptyStartPointAndAmount(index),animalCells=this.filterEmptyCell(columnLine),newCellsLine=this.fillNewCells(animalCells,emptyAmount,index);for(const idx in newCellsLine){const idxx=Number(idx),cell=newCellsLine[idxx];this.map[idxx][cell.x]=cell,promises.push(new Promise(resolve=>{cell.moveY(idxx).then(()=>{cell.y=idxx,resolve(cell)})}))}return Promise.all(promises)}searchMockRowsAndFilterPangable(mockMap,round=2){var _a,_b,_c;const rowTemp=[];for(const row of mockMap){for(const cell of row){const isEmpty=rowTemp.length===0,isEmptyLastArray=((_a=rowTemp[rowTemp.length-1])==null?void 0:_a.length)===0,isDifferenceType=((_c=(_b=rowTemp[rowTemp.length-1])==null?void 0:_b[0])==null?void 0:_c.type)!==cell.type;(isEmpty||isEmptyLastArray||isDifferenceType)&&rowTemp.push([]),cell.type.match(/^(vertical|horizon|all)$/g)||rowTemp[rowTemp.length-1].push(cell)}rowTemp.push([])}return rowTemp.filter(row=>row.length>round)}searchMockColumnsAndFilterPangable(mockMap,round=2){var _a,_b,_c;const columnTemp=[];for(let index=0;index<OPTIONS.WIDTH.GAME.X;index++){const columns=this.getMockColumnLine(mockMap,index);for(const cell of columns){const isEmpty=columnTemp.length===0,isEmptyLastArray=((_a=columnTemp[columnTemp.length-1])==null?void 0:_a.length)===0,isDifferenceType=((_c=(_b=columnTemp[columnTemp.length-1])==null?void 0:_b[0])==null?void 0:_c.type)!==cell.type;(isEmpty||isEmptyLastArray||isDifferenceType)&&columnTemp.push([]),cell.type.match(/^(vertical|horizon|all)$/g)||columnTemp[columnTemp.length-1].push(cell)}columnTemp.push([])}return columnTemp.filter(column=>column.length>round)}searchRowsAndFilterPangable(round=2){var _a,_b,_c;const rowTemp=[];for(const row of this.map){for(const cell of row){const isEmpty=rowTemp.length===0,isEmptyLastArray=((_a=rowTemp[rowTemp.length-1])==null?void 0:_a.length)===0,isDifferenceType=((_c=(_b=rowTemp[rowTemp.length-1])==null?void 0:_b[0])==null?void 0:_c.type)!==cell.type;(isEmpty||isEmptyLastArray||isDifferenceType)&&rowTemp.push([]),rowTemp[rowTemp.length-1].push(cell)}rowTemp.push([])}return rowTemp.filter(row=>row.length>round).filter(group=>!group[0].checkTypeItem()&&group.every(gp=>gp.type===group[0].type))}searchColumnsAndFilterPangable(round=2){var _a,_b,_c;const columnTemp=[];for(let index=0;index<OPTIONS.WIDTH.GAME.X;index++){const columns=this.getColumnLine(index);for(const cell of columns){const isEmpty=columnTemp.length===0,isEmptyLastArray=((_a=columnTemp[columnTemp.length-1])==null?void 0:_a.length)===0,isDifferenceType=((_c=(_b=columnTemp[columnTemp.length-1])==null?void 0:_b[0])==null?void 0:_c.type)!==cell.type;(isEmpty||isEmptyLastArray||isDifferenceType)&&columnTemp.push([]),columnTemp[columnTemp.length-1].push(cell)}columnTemp.push([])}return columnTemp.filter(column=>column.length>round).filter(group=>!group[0].checkTypeItem()&&group.every(gp=>gp.type===group[0].type))}async searchColumnsAndFillEmptyCell(){this.logger.dir("searchColumnsAndFillEmptyCell").log("start search empty column and fill cells...");const promises=[];for(let index=0;index<OPTIONS.WIDTH.GAME.X;index++)promises.push(this.columnFillNewAnimals(index));return await Promise.all(promises),this.map.flat(1).every(cell=>cell.type!=="")}async columnFillNewAnimals(x){const[startPoint,emptyAmount]=this.getEmptyStartPointAndAmount(x),columnLine=this.getColumnLine(x),filterCells=this.filterEmptyCell(columnLine),concatOriginAndNewCells=this.fillNewCells(filterCells,emptyAmount,x),animationTemp=[];concatOriginAndNewCells.forEach(cell=>{var _a,_b;const copyCell=cell.deepCopySelf();animationTemp.push(copyCell),(_b=(_a=this.map)==null?void 0:_a[cell.y])!=null&&_b[cell.x]&&(this.map[cell.y][cell.x]=copyCell)});const promiseTemp=[];for(const tempCell of animationTemp){let resolver;const aniPromise=new Promise(resolve=>resolver=resolve);promiseTemp.push(aniPromise);const tempCellY=tempCell.y;tempCell.y-=emptyAmount;const aniLoop=setInterval(()=>{tempCell.y+=OPTIONS.ANIMATION.SPEED/2,tempCell.y>=tempCellY&&(tempCell.y=tempCellY,clearInterval(aniLoop),resolver(!0))},OPTIONS.ANIMATION.FRAME)}return Promise.all(promiseTemp)}findEmptyCell(cells){return cells.find(cell=>cell.type==="")}filterEmptyCell(cells){return cells.filter(cell=>cell.type!=="")}fillNewCells(origin,emptyAmount,x){const tempEmptyAmount=emptyAmount,temp=origin.map(cell=>cell.deepCopySelf());for(let index=1;index<=tempEmptyAmount;index++){const[type,score]=this.getRandomCellType(),copyCell=new Cell(type,x,1-index-1,score);temp.unshift(copyCell)}return temp}getEmptyStartPointAndAmount(x){const yValue=OPTIONS.WIDTH.GAME.Y-1;let startPoint=-1,emptyAmount=0;for(let level=yValue;level>=0;level--){const cell=this.map[level][x];cell.type===""&&(emptyAmount+=1,startPoint<cell.y&&(startPoint=cell.y))}return[startPoint,emptyAmount]}render(){if(this.dupRemove)for(const row of this.map)for(const cell of row)cell.render()}}class MapGenerator extends BaseModule{constructor(mode,x=OPTIONS.WIDTH.GAME.X,y=OPTIONS.WIDTH.GAME.Y){super(mode);__publicField(this,"map",[]);__publicField(this,"mapSize",[0,0]);__publicField(this,"logger");this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode),this.mapSize=[x,y]}initialize(map){this.logger.dir("initialize").log("get created map",map),this.map=map}render(){if(bgCtx.fillStyle=BG_COLOR+"b6",bgCtx.fillRect(0,0,innerWidth,innerHeight),this.mode==="test"){bgCtx.strokeStyle=CELL_OUTLINE_COLOR+"26";for(const row of this.map)for(const cell of row){const[x,y]=responseBlockAxis(cell.x*RESPONSIVE_UNIT_SIZE(),cell.y*RESPONSIVE_UNIT_SIZE());bgCtx.strokeRect(x,y,RESPONSIVE_UNIT_SIZE(),RESPONSIVE_UNIT_SIZE())}bgCtx.strokeStyle=CELL_OUTLINE_COLOR}effectCtx.fillStyle=BG_COLOR,effectCtx.fillRect(0,0,innerWidth,(innerHeight-OPTIONS.WIDTH.GAME.Y*RESPONSIVE_UNIT_SIZE())/2),effectCtx.fillRect(0,OPTIONS.WIDTH.GAME.Y*RESPONSIVE_UNIT_SIZE()+(innerHeight-OPTIONS.WIDTH.GAME.Y*RESPONSIVE_UNIT_SIZE())/2,innerWidth,(innerHeight-OPTIONS.WIDTH.GAME.Y*RESPONSIVE_UNIT_SIZE())/2),effectCtx.fillRect(0,0,innerWidth/2-OPTIONS.WIDTH.GAME.X*RESPONSIVE_UNIT_SIZE()/2,innerHeight),effectCtx.fillRect(innerWidth/2-OPTIONS.WIDTH.GAME.X*RESPONSIVE_UNIT_SIZE()/2+OPTIONS.WIDTH.GAME.X*RESPONSIVE_UNIT_SIZE(),0,innerWidth/2-OPTIONS.WIDTH.GAME.X*RESPONSIVE_UNIT_SIZE()/2,innerHeight)}clearSelect(){this.map.flat(1).forEach(cell=>cell.isSelected=!1)}}class Pointer extends BaseModule{constructor(mode){super(mode);__publicField(this,"logger");__publicField(this,"dependency",{});__publicField(this,"grab",null);__publicField(this,"swapTemp",[]);__publicField(this,"gameEnd",!1);__publicField(this,"bindTouchStart");__publicField(this,"bindMoveMouse");__publicField(this,"bindClickCell");this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode),this.bindTouchStart=this.touchStart.bind(this),this.bindMoveMouse=this.moveMouse.bind(this),this.bindClickCell=this.clickCell.bind(this),this.initialize()}initialize(){window.removeEventListener("touchstart",this.bindTouchStart),window.removeEventListener("mousemove",this.bindMoveMouse),window.removeEventListener("mousedown",this.bindClickCell),isMobile()?window.addEventListener("touchstart",this.bindTouchStart):(window.addEventListener("mousemove",this.bindMoveMouse),window.addEventListener("mousedown",this.bindClickCell))}inject(module){this.logger.dir("inject").debug(`${capitalize(module.constructor.name)} is injected`),this.dependency[capitalize(module.constructor.name)]=module}async touchStart(e){const touch=e.touches[0];this.moveMouse(touch),await this.clickCell(touch)}async clickCell(e){var _a,_b,_c,_d,_e,_f,_g,_h,_i,_j,_k,_l,_m,_n,_o,_p;if(this.logger.dir("clickCell").dir("debug wait").debug("!!!!!!!!wait",wait),wait.length>0){this.logger.dir("clickCell").error("current working click event",wait);return}if(this.grab){if(this.logger.dir("clickCell").debug(this.grab),this.swapTemp.length<2){if(this.swapTemp.length===0&&(wait.push(0),await this.grab.zoomMotion(),wait.pop()),this.swapTemp.push(this.grab),this.grab.isSelected=!0,this.swapTemp.length===2&&this.swapTemp.forEach(cell=>cell.scale=1),this.logger.dir("clickCell").log(this.swapTemp),this.logger.dir("clickCell").dir("select first cell").debug(this.swapTemp[0]),this.swapTemp[0].type.match(/^(horizon)$/g)){wait.push(0),await((_a=this.dependency.blockManager)==null?void 0:_a.horizonPangAndAutoFill(this.swapTemp[0].x,this.swapTemp[0].y)),this.swapTemp=[],wait.pop();return}if(this.swapTemp[0].type.match(/^(vertical)$/g)){wait.push(0),await((_b=this.dependency.blockManager)==null?void 0:_b.verticalPangAndAutoFill(this.swapTemp[0].x,this.swapTemp[0].y)),this.swapTemp=[],wait.pop();return}if(this.swapTemp[0].type.match(/^(all)$/g)){wait.push(0),await((_c=this.dependency.blockManager)==null?void 0:_c.allPangAndAutoFill(this.swapTemp[0].x,this.swapTemp[0].y)),this.swapTemp=[],wait.pop();return}}if(this.swapTemp.length===2){if(this.logger.dir("clickCell").log(this.swapTemp),this.logger.dir("clickCell").log("this.swapTemp length",2),this.dependency.blockManager&&this.swapTemp[0]!==this.swapTemp[1]&&wait.length===0){this.logger.dir("clickCell").dir("select second cell").debug(this.grab),wait.push(0),this.logger.dir("clickCell").log("swap both run");const isBoundary=this.dependency.blockManager.isInBoundary(this.swapTemp[0],this.swapTemp[1]);this.logger.dir("clickCell").debug("isBoundary",isBoundary),isBoundary&&((_d=this.dependency.scoreCalculator)==null||_d.turnCount());try{if(!await this.dependency.blockManager.swapBothCell(this.swapTemp[0],this.swapTemp[1])){this.logger.dir("swapBothCellAndFill").error("not swapped"),isBoundary&&((_e=this.dependency.scoreCalculator)==null||_e.divideCombo());const first=(_j=(_g=this.dependency.blockManager.map)==null?void 0:_g[(_f=this.swapTemp[0])==null?void 0:_f.y])==null?void 0:_j[(_i=(_h=this.swapTemp)==null?void 0:_h[0])==null?void 0:_i.x],second=(_o=(_l=this.dependency.blockManager.map)==null?void 0:_l[(_k=this.swapTemp[1])==null?void 0:_k.y])==null?void 0:_o[(_n=(_m=this.swapTemp)==null?void 0:_m[1])==null?void 0:_n.x];await this.dependency.blockManager.revertSwap(first,second),await this.dependency.blockManager.autoPangAndFill(),wait.pop(),console.log("wait initialize"),this.swapTemp[0]&&(this.swapTemp[0].isSelected=!1),this.swapTemp[1]&&(this.swapTemp[1].isSelected=!1),this.swapTemp=[];return}}catch{return}await this.dependency.blockManager.autoPangAndFill(),this.logger.dir("clickCell").debug("release??"),wait.pop(),this.swapTemp[0]&&(this.swapTemp[0].isSelected=!1),this.swapTemp[1]&&(this.swapTemp[1].isSelected=!1),this.logger.dir("clickCell").log("swap both end")}this.logger.dir("clickCell").log(this.swapTemp),this.swapTemp[0]&&(this.swapTemp[0].isSelected=!1),this.swapTemp[1]&&(this.swapTemp[1].isSelected=!1),this.swapTemp=[],this.logger.dir("clickCell").log(this.swapTemp)}this.logger.dir("clickCell2").debug(this.swapTemp)}else this.logger.dir("clickCell").debug("no grab"),this.swapTemp.length>0&&(this.swapTemp.forEach(cell=>{cell.isHover=!1,cell.isSelected=!1,cell.scale=1}),this.swapTemp=[]);this.logger.dir("clickCell").debug("map",(_p=this.dependency.blockManager)==null?void 0:_p.map)}moveMouse(e){if(wait.length>0)return;const x=e.clientX,y=e.clientY,[resX,resY]=responsePointerAxis(x,y);try{if(this.gameEnd)throw new Error("the game end");const cell=this.getCellInfo(resX,resY);this.grab=cell,this.grab.isHover||(this.grab.isHover=!0)}catch{this.grab=null}}getCellInfo(x,y){var _a,_b;if(this.dependency.mapGenerator){const cell=(_b=(_a=this.dependency.mapGenerator.map)==null?void 0:_a[y])==null?void 0:_b[x];if(cell)return cell;throw new Error("not found cell")}throw new Error("no injected module")}}class QuestManager{constructor(mode){__publicField(this,"id");__publicField(this,"mode");__publicField(this,"quests",[]);__publicField(this,"logger");__publicField(this,"lineGap",16*1.3);__publicField(this,"animalsPang",{cat:0,dog:0,lion:0,duck:0,mouse:0,rabbit:0,panda:0,pig:0,racoon:0});__publicField(this,"dependency",{});__publicField(this,"deleteQueue",[]);this.mode=mode,this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode)}inject(module){this.logger.dir("inject").debug(`${capitalize(module.constructor.name)} is injected`),this.dependency[capitalize(module.constructor.name)]=module}resetQuest(){this.quests=[],this.deleteQueue=[],this.autoQuests()}addQuest(a,b,c,d){if(!(a instanceof Quest)&&b&&c!==void 0&&d){this.logger.dir("addQuest").log("add new quest");const newQeust=new Quest(a,b,c,d);this.quests.push(newQeust)}else if(a instanceof Quest)this.logger.dir("addQuest").log("add new quest"),this.quests.push(a);else throw new Error("Invalid quest arguments")}removeQuest(quest){quest.deletion=!0,this.deleteQueue.push(quest)}autoQuests(){if(this.dependency.blockManager)for(;this.quests.length<2;){const obj=QUEST_LIST_OBJ[Math.floor(QUEST_LIST_OBJ.length*Math.random())],randomQuest=new Quest(obj.title,obj.content,{type:obj.type,amount:obj.amount},{score:obj.score,turn:obj.turn});!this.quests.some(q=>q.condition.type===randomQuest.condition.type)&&this.dependency.blockManager.containsType(randomQuest.condition.type)?this.quests.push(randomQuest):(this.logger.dir("autoQuests").debug("Quest id minus",Quest.id),Quest.id-=1)}}questAmountUp(type){const quests=this.quests.filter(quest=>quest.condition.type===type);this.logger.dir("questAmountUp").debug(type),quests.forEach(quest=>{quest.currentAmount+=1})}getLineGroup(quest,base,contentVisible){questCtx.font="bold 16px Arial",questCtx.fillText(`${quest.title} (+${quest.result.score}P)${quest.result.turn>0?` (+${quest.result.turn}T)`:""}`,50,base),quest.isDone&&questCtx.fillRect(50,base-6,questCtx.measureText(quest.title+` (+${quest.result.score}P)`).width,1),questCtx.font="normal 16px Arial",contentVisible&&(questCtx.fillText(quest.content,50,base+this.lineGap*1),quest.isDone&&questCtx.fillRect(50,base+this.lineGap*1-6,questCtx.measureText(quest.content).width,1)),questCtx.fillText(`${quest.currentAmount}/${quest.condition.amount}`,50,base+this.lineGap*(contentVisible?2:1)),quest.isDone&&questCtx.fillRect(50,base+this.lineGap*(contentVisible?2:1)-6,questCtx.measureText(`${quest.currentAmount}/${quest.condition.amount}`).width,1)}render(){var _a,_b;const contentVisible=!!isMobile()&&innerHeight>800,topBase=(()=>innerWidth>900?contentVisible?120:50:contentVisible?70:45)(),responseRatio=(()=>innerWidth>900?contentVisible?50:100:innerWidth<=900&&innerWidth>=500?contentVisible?50:90:contentVisible?90:95)();for(const quest of this.quests){const base=this.quests.indexOf(quest)*topBase+responseRatio;this.getLineGroup(quest,base,contentVisible),quest.currentAmount>=quest.condition.amount&&(quest.isDone||(quest.success(),(_a=this.dependency.scoreCalculator)==null||_a.scoreUp(quest.result.score),(_b=this.dependency.scoreCalculator)==null||_b.turnUp(quest.result.turn),this.logger.dir("success").log(`clear quest, get score +${quest.result.score}`),this.removeQuest(quest)))}for(questCtx.font="normal 16px Arial";this.deleteQueue.length>0;){const quest=this.deleteQueue.shift();quest&&(this.logger.dir("while").dir("if").debug(quest),setTimeout(()=>{const index=this.quests.findIndex(q=>q.id===quest.id);this.logger.dir("while").dir("index").debug(index),index>-1&&this.quests.splice(index,1),this.logger.dir("while").dir("check").debug(this.quests),this.autoQuests()},3e3))}}}class ScoreCalculator extends BaseModule{constructor(mode){super(mode);__publicField(this,"logger");__publicField(this,"hint",OPTIONS.GAME.HINT);__publicField(this,"scores",0);__publicField(this,"turn",0);__publicField(this,"combo",0);__publicField(this,"scoreIncrementRatioByCombo",1);mode==="none"?this.turn=OPTIONS.GAME.TURN:mode==="test"&&(this.turn=1/0),this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode)}scoreUp(score){this.scores+=score*this.scoreIncrementRatioByCombo,this.logger.dir("scoreUp").debug("get score",score)}turnUp(turn=0){this.turn+=turn}turnCount(){this.logger.dir("turnCount").debug("count minus",this.turn),this.turn-=1}countUpCombo(){this.combo+=1,this.logger.dir("countUpCombo").debug("count up combo",this.combo)}showHint(){this.hint-=1}calculateScoreIncrementRatioByCombo(){this.combo<10?this.scoreIncrementRatioByCombo=1:this.combo<30&&this.combo>=10?this.scoreIncrementRatioByCombo=2:this.combo<50&&this.combo>=30?this.scoreIncrementRatioByCombo=3:this.combo<70&&this.combo>=50?this.scoreIncrementRatioByCombo=4:this.combo<90&&this.combo>=70?this.scoreIncrementRatioByCombo=5:this.combo>=90&&(this.scoreIncrementRatioByCombo=6)}resetHints(){this.hint=OPTIONS.GAME.HINT}resetTurns(){this.turn=OPTIONS.GAME.TURN}resetScores(){this.scores=0}resetCombos(){this.combo=0,this.scoreIncrementRatioByCombo=1,this.logger.dir("resetCombo").debug("reset combo",this.combo)}minusCombo(combo){this.combo-=combo}divideCombo(){this.combo=Math.floor(this.combo/2)}popupEndModal(){const wrap=document.createElement("div");wrap.id="modal",wrap.innerHTML=`
      <div class="modal-head">
        <span>
        알림
        </span>
        <button id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        아쉽지만 턴이 끝났습니다 🥲
        <br />
        새 게임을 시작하시겠습니까?
        <br />
        <br />
        <button id="newGame">✨ 새로운 게임</button>
      </div>
    `,document.body.append(wrap)}popupShuffleModal(){const wrap=document.createElement("div");wrap.id="modal",wrap.innerHTML=`
      <div class="modal-head">
        <span>
        알림
        </span>
        <button id="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        일치 가능한 동물이 없습니다. 동물을 재배치 합니다.
        <br />
        <br />
        <button id="refreshGame">✨ 재배치</button>
      </div>
    `,document.body.append(wrap)}render(){this.calculateScoreIncrementRatioByCombo(),scoreCtx.font="bold 16px Arial",scoreCtx.textAlign="left",scoreCtx.fillStyle="#000000";const scoreText=`score: ${this.scores} Point${this.scores>1?"s":""}  Hint: ${this.hint}`;scoreCtx.fillText(scoreText,50,50-(isMobile()?20:0)),this.turn>5&&this.turn<10?scoreCtx.fillStyle="#ffff00":this.turn<=5&&(scoreCtx.fillStyle="#ff0000");const turnText=`turn: ${this.turn} Turn${this.turn>1?"s":""}`;scoreCtx.fillText(turnText,50,70-(isMobile()?20:0)),scoreCtx.fillText(`Combo: ${this.combo}`,scoreCtx.measureText(turnText).width+50+10,70-(isMobile()?20:0))}}class StoreManager extends BaseModule{constructor(mode,storeName){super(mode);__publicField(this,"storeName");__publicField(this,"logger");__publicField(this,"store",[]);this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").log("initialize mode:",mode),this.storeName=storeName||"pang_store",this.getData()}getLocalStorage(){return JSON.parse(localStorage.getItem(this.storeName)||"[]")}saveLocalStorage(){localStorage.setItem(this.storeName,JSON.stringify(this.store))}saveStore(data){this.store=data}getStore(){return this.store}getData(){const data=this.getLocalStorage();this.saveStore(data)}saveData(data){this.saveStore(data),this.saveLocalStorage()}addData(data){this.store.push(data),this.saveLocalStorage()}}class GameCore extends BaseModule{constructor(){super(RUN_MODE);__publicField(this,"seek",0);__publicField(this,"blockManager");__publicField(this,"animator");__publicField(this,"mapGenerator");__publicField(this,"scoreCalculator");__publicField(this,"storeManager");__publicField(this,"pointer");__publicField(this,"questManager");__publicField(this,"logger");__publicField(this,"canvases",[]);__publicField(this,"gameEnd",!1);__publicField(this,"_dev");__publicField(this,"_runMode");__publicField(this,"_baseWidth",innerWidth);__publicField(this,"_baseHeight",innerHeight);__publicField(this,"_storeName");__publicField(this,"_animation");__publicField(this,"currentMobile",isMobile());__publicField(this,"questQueue",[]);__publicField(this,"handleResizeCanvasSize",()=>{this.logger.dir("setupCanvas").dir("handleResizeCanvasSize").log("resize all canvas");for(const canvas of this.canvases)canvas.width=innerWidth,canvas.height=innerHeight,this.logger.dir("handleResizeCanvasSize").dir("if").debug(this._baseWidth,innerWidth,RESPONSIVE_UNIT_SIZE()),innerWidth<=280?SUB_OPTIONS.SIZE.RATIO=-25:innerWidth<=375?SUB_OPTIONS.SIZE.RATIO=-15:innerWidth<=390?SUB_OPTIONS.SIZE.RATIO=-14:innerWidth<=393?SUB_OPTIONS.SIZE.RATIO=-15:innerWidth<=414?SUB_OPTIONS.SIZE.RATIO=-12:innerWidth<=540?SUB_OPTIONS.SIZE.RATIO=-3:innerWidth<=820?SUB_OPTIONS.SIZE.RATIO=15:innerWidth<=1024?SUB_OPTIONS.SIZE.RATIO=5:innerWidth<=1280?SUB_OPTIONS.SIZE.RATIO=6:SUB_OPTIONS.SIZE.RATIO=5;this.currentMobile!==isMobile()&&(this.currentMobile=isMobile(),this.pointer.initialize())});this.logger=new Logger(this.constructor.name),this.logger.dir("constructor").debug("dev",this._dev),this.logger.dir("constructor").debug("run mode",this._runMode),this.logger.dir("constructor").log("setup game core..."),window.addEventListener("click",this.handleNewGame.bind(this)),this.createNewGameButton()}initialCommitQuestInQueue(){for(;this.questQueue.length>0;){const quest=this.questQueue.pop();quest&&this.questManager.addQuest(quest)}}showHint(){const hintTemp=[];return this.scoreCalculator.hint>0&&(this.scoreCalculator.showHint(),this.blockManager.getHint(),this.blockManager.map.flat(1).forEach(cell=>{cell.isHint&&hintTemp.push(cell)}),document.querySelectorAll("#hintingGame").forEach(el=>el.disabled=!0)),this.scoreCalculator.hint===0&&document.querySelectorAll("#hintingGame").forEach(el=>el.disabled=!0),new Promise(resolve=>{setTimeout(()=>{hintTemp.forEach(cell=>cell.isHint=!1),resolve(!0),this.scoreCalculator.hint===0?document.querySelectorAll("#hintingGame").forEach(el=>el.disabled=!0):document.querySelectorAll("#hintingGame").forEach(el=>el.disabled=!1)},3e3)})}async refreshGame(force=!1){this.gameEnd=!1,this.pointer.gameEnd=!1;const score=this.scoreCalculator.scores,turn=this.scoreCalculator.turn,combo=this.scoreCalculator.combo,quests=this.questManager.quests.map(q=>{const qst=Quest.createQuest({title:q.title,content:q.content,score:q.result.score,turn:q.result.turn,type:q.condition.type,amount:q.condition.amount});return qst.currentAmount=q.currentAmount,qst}),map=await this.blockManager.initialize(force);this.mapGenerator.initialize(map),this.blockManager.resetScore(),this.blockManager.resetQuest(),this.scoreCalculator.scores=score,this.scoreCalculator.turn=turn,this.scoreCalculator.combo=combo,this.questManager.quests=quests,setTimeout(()=>{this.execInitialPang()},16)}resetScore(){this.scoreCalculator.resetCombos(),this.scoreCalculator.resetScores(),this.scoreCalculator.resetTurns(),this.scoreCalculator.resetHints()}resetQuest(){this.questManager.resetQuest()}async newGame(force=!1){this.gameEnd=!1,this.pointer.gameEnd=!1,this.blockManager.gameEnd=!1;const map=await this.blockManager.initialize(force);this.mapGenerator.initialize(map),this.resetScore(),this.resetQuest(),this.autoQuests(),this.blockManager.animalsPang={cat:0,dog:0,lion:0,duck:0,mouse:0,rabbit:0,panda:0,pig:0,racoon:0},document.querySelectorAll("#hintingGame").forEach(el=>el.disabled=!1),setTimeout(()=>{this.execInitialPang()},16)}stopRender(){cancelAnimationFrame(this._animation)}createNewGameButton(){const wrap=document.createElement("div");wrap.id="btnWrap";const button=document.createElement("button");button.id="restartGame",button.innerText="✨ 새로운 게임";const button3=document.createElement("button");button3.id="hintingGame",button3.innerText="🔎 힌트",wrap.append(button3,button),document.body.append(wrap)}async handleNewGame(e){const target=e.target;target&&target.id.match(/^(newGame|restartGame)/)?(await this.newGame(!0),this.gameEnd=!1,window.removeEventListener("click",this.handleNewGame.bind(this)),wait.splice(0),setTimeout(()=>{document.querySelectorAll("#modal").forEach(modal=>modal.remove())},10)):target&&target.id==="refreshGame"?(document.querySelectorAll("#modal").forEach(modal=>modal.remove()),await this.refreshGame(!0)):target&&target.id==="hintingGame"?await this.showHint():target&&target.id==="modal-close"&&document.querySelectorAll("#modal").forEach(modal=>modal.remove())}setOption(property,value){if(`_${property}`in this)this.logger.dir("setOption").log(`success set option, property: ${property}, value: ${value}`),this[`_${property}`]=value;else throw new Error(`${property} is not a valid property`)}async initialize(){this.logger.dir("initialize").log("initialize"),this.loadModules(),this.setupCanvas(bgCanvas,gameCanvas,effectCanvas,scoreCanvas,selectCanvas,questCanvas),this.injection();const map=await this.blockManager.initialize();return this.mapGenerator.initialize(map),this.blockManager.gameEnd=this.gameEnd,!0}autoQuests(){this.questManager.autoQuests()}loadModules(){this.logger.dir("loadModules").log("start..."),this.scoreCalculator=new ScoreCalculator(this.mode),this.questManager=new QuestManager(this.mode),this.blockManager=new BlockManager(this.mode,this.scoreCalculator,this.questManager),this.questManager.animalsPang=this.blockManager.animalsPang,this.animator=new Animator(this.mode),this.mapGenerator=new MapGenerator(this.mode),this.pointer=new Pointer(this.mode),this.storeManager=new StoreManager(this.mode,this._storeName),this.logger.dir("loadModules").log("success!")}setupCanvas(...canvases){this.canvases=canvases,this.logger.dir("setupCanvas").log("setup canvas elements");for(const canvas of canvases)this.logger.dir("setupCanvas").log(`add ${canvas.id} canvas`),ROOT.append(canvas);this.handleResizeCanvasSize(),this.logger.dir("setupCanvas").log("add event window resize detect"),window.addEventListener("resize",this.handleResizeCanvasSize.bind(this))}injection(){this.pointer.inject(this.blockManager),this.pointer.inject(this.mapGenerator),this.pointer.inject(this.scoreCalculator),this.questManager.inject(this.blockManager),this.questManager.inject(this.scoreCalculator)}animation(time){this.clearRect(),time*=.001,wait.length===0&&!this.gameEnd&&this.scoreCalculator.turn===0&&(wait.push(0),this.gameEnd=!0,this.blockManager.gameEnd=!0,this.pointer.gameEnd=!0,setTimeout(()=>{this.scoreCalculator.popupEndModal()},16)),Math.floor(time),this.seek,this.scoreCalculator.render(),this.mapGenerator.render(),this.blockManager.render(),this.questManager.render(),bgCtx.restore(),scoreCtx.restore(),gameCtx.restore(),selectCtx.restore(),effectCtx.restore(),questCtx.restore(),this._animation=requestAnimationFrame(this.animation.bind(this)),this.seek=Math.floor(time)}clearRect(){bgCtx.clearRect(0,0,innerWidth,innerHeight),scoreCtx.clearRect(0,0,innerWidth,innerHeight),gameCtx.clearRect(0,0,innerWidth,innerHeight),effectCtx.clearRect(0,0,innerWidth,innerHeight),selectCtx.clearRect(0,0,innerWidth,innerHeight),questCtx.clearRect(0,0,innerWidth,innerHeight),bgCtx.save(),scoreCtx.save(),gameCtx.save(),effectCtx.save(),selectCtx.save(),questCtx.save()}render(){this.logger.dir("render").log("start game core rendering..."),this.logger.dir("render").log("start calulator rendering..."),this.logger.dir("render").log("start game map rendering..."),this.logger.dir("render").log("start block rendering..."),setTimeout(()=>{this.execInitialPang()},500),this._animation=requestAnimationFrame(this.animation.bind(this))}execInitialPang(){wait.splice(0),wait.length===0&&(wait.push(0),this.blockManager.autoPangAndFill().then(()=>{wait.pop()}))}renderPerSecond(){}}const gameCore=new GameCore;gameCore.setOption("dev",MODE);gameCore.setOption("runMode",RUN_MODE);gameCore.setOption("storeName",STORE_NAME);gameCore.initialize().then(()=>{gameCore.autoQuests(),gameCore.render()});
